<!DOCTYPE html>
<html lang='en' data-theme='corporate-blue'>
<head>
    <meta charset='UTF-8'/>
    <meta content='width=device-width, initial-scale=1.0' name='viewport'/>
    
    <!-- =================================================================== -->
    <!-- SEO & META TAGS - FOR PDF to OCR WORD TOOL -->
    <!-- =================================================================== -->
    <title>Free PDF to Word with OCR - Convert Scanned PDF | JKM Edit</title>
    <meta name="description" content="Convert your PDF files (up to 5 pages), including scanned documents, to editable Word (DOCX) files using our high-quality online converter. Free, fast, and secure."/>
    <meta name="keywords" content="pdf to word, ocr, pdf to docx, convert pdf, high quality pdf to word, free ocr, online converter, jkm edit"/>
    <meta name="author" content="JKM Edit"/>
    <meta name="robots" content="index, follow"/>
    <link rel="canonical" href="https://jkmpdf.github.io/JKMEDIT/pdf-tools/pdf-to-ocr-word.html"/>
    <meta property="og:title" content="High-Quality PDF to Word with OCR | JKM Edit"/>
    <meta property="og:description" content="Turn any PDF into a perfectly formatted, editable Word document. Our free online tool uses advanced OCR to handle scanned pages with ease."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://jkmpdf.github.io/JKMEDIT/pdf-tools/pdf-to-ocr-word.html"/>
    <meta property="og:image" content="https://jkmpdf.github.io/JKMEDIT/assets/og-preview-image.png"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:title" content="High-Quality PDF to Word with OCR | JKM Edit"/>
    <meta name="twitter:description" content="Turn any PDF into a perfectly formatted, editable Word document. Our free online tool uses advanced OCR to handle scanned pages with ease."/>
    <meta name="twitter:image" content="https://jkmpdf.github.io/JKMEDIT/assets/og-preview-image.png"/>
    <!-- =================================================================== -->

    <!-- SCRIPT TO PREVENT THEME AND BACKGROUND FLICKERING (KEEP THIS) -->
    <script>
        (function() {
            try {
                const themeBgColors = {
                    'corporate-blue': { light: '#f4f5f7', dark: '#121212' },'forest-green':   { light: '#f0f3f2', dark: '#121212' },'sunset-gradient':{ light: '#fff8f2', dark: '#121212' },'tech-noir':      { light: '#1a1a2e', dark: '#0f0f1e' },'minty-fresh':    { light: '#f1fefb', dark: '#121212' },'royal-purple':   { light: '#f8f7fa', dark: '#121212' },'graphite-gray':  { light: '#e9ecef', dark: '#121212' },'crimson-red':    { light: '#fdf5f6', dark: '#121212' }
                };
                const theme = localStorage.getItem('jkm-edit-theme') || 'corporate-blue';
                const mode = localStorage.getItem('jkm-edit-mode') || 'light';
                document.documentElement.setAttribute('data-theme', theme);
                if (mode === 'dark') { document.documentElement.classList.add('dark-mode'); }
                const bgColor = (themeBgColors[theme] && themeBgColors[theme][mode]) || '#f4f5f7';
                const style = document.createElement('style');
                style.innerHTML = `html { background-color: ${bgColor} !important; }`;
                document.head.appendChild(style);
            } catch (e) { console.error("Error applying initial theme:", e); }
        })();
    </script>
    
    <!-- Firebase SDK - Updated with your configuration -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <!-- Add Firebase Google Auth Provider SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script> 
    <script>
        // Your web app's Firebase configuration - THIS IS YOURS!
        const firebaseConfig = {
          apiKey: "AIzaSyBOXMffkcv4wYubtkFbkpq6w20Ya0t7KMU",
          authDomain: "jkm-edit-auth.firebaseapp.com",
          projectId: "jkm-edit-auth",
          storageBucket: "jkm-edit-auth.firebasestorage.app",
          messagingSenderId: "445112295101",
          appId: "1:445112295101:web:c6bba4454c1951642361d4",
          measurementId: "G-0QKSL4W36S"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth(); // Get a reference to the Auth service
        // Initialize Google Auth Provider
        const googleProvider = new firebase.auth.GoogleAuthProvider();
    </script>
    <!-- END Firebase SDK -->

    <link href='https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap' rel='stylesheet'/>
    <link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css' rel='stylesheet'/>
    <!-- PDF.js Library for page counting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script>pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js`;</script>


    <style>
        /* --- Basic Setup & Variables --- */
        :root { font-family: 'Poppins', sans-serif; --transition-speed: 0.3s; }
        html, body {
            margin: 0;
            min-height: 100vh; /* Ensure body takes full viewport height */
        }
        body { color: var(--text-color); background-color: var(--bg-color); transition: background-color var(--transition-speed), color var(--transition-speed); }
        *, *::before, *::after { box-sizing: border-box; }
        .hidden { display: none !important; } /* Added for general utility */

        /* --- THEME DEFINITIONS --- */
        [data-theme='corporate-blue'] { --primary-color: #0052cc; --secondary-color: #0747a6; --bg-color: #f4f5f7; --surface-color: #ffffff; --text-color: #172b4d; --accent-color: #ffab00; --gradient: linear-gradient(45deg, var(--primary-color), #0065ff); }
        [data-theme='forest-green'] { --primary-color: #28a745; --secondary-color: #218838; --bg-color: #f0f3f2; --surface-color: #ffffff; --text-color: #343a40; --accent-color: #ffc107; --gradient: linear-gradient(45deg, var(--primary-color), #34d058); }
        [data-theme='sunset-gradient'] { --primary-color: #fd7e14; --secondary-color: #e65100; --bg-color: #fff8f2; --surface-color: #ffffff; --text-color: #492b0e; --accent-color: #20c997; --gradient: linear-gradient(45deg, #ff4e50, #f9d423); }
        [data-theme='tech-noir'] { --primary-color: #e83e8c; --secondary-color: #d81b60; --bg-color: #1a1a2e; --surface-color: #242444; --text-color: #e0e0e0; --accent-color: #00bcd4; --gradient: linear-gradient(45deg, #4a00e0, #8e2de2); }
        [data-theme='minty-fresh'] { --primary-color: #1abc9c; --secondary-color: #16a085; --bg-color: #f1fefb; --surface-color: #ffffff; --text-color: #3d524d; --accent-color: #f39c12; --gradient: linear-gradient(45deg, #1abc9c, #1dd3b0); }
        [data-theme='royal-purple'] { --primary-color: #6f42c1; --secondary-color: #5a32a3; --bg-color: #f8f7fa; --surface-color: #ffffff; --text-color: #343a40; --accent-color: #fd7e14; --gradient: linear-gradient(45deg, #6f42c1, #8a5fd6); }
        [data-theme='graphite-gray'] { --primary-color: #6c757d; --secondary-color: #5a6268; --bg-color: #e9ecef; --surface-color: #f8f9fa; --text-color: #212529; --accent-color: #007bff; --gradient: linear-gradient(45deg, #6c757d, #adb5bd); }
        [data-theme='crimson-red'] { --primary-color: #dc3545; --secondary-color: #c82333; --bg-color: #fdf5f6; --surface-color: #ffffff; --text-color: #343a40; --accent-color: #ffc107; --gradient: linear-gradient(45deg, #dc3545, #f05a68); }

        /* --- DARK MODE (Applied to <html> tag now) --- */
        html.dark-mode { --bg-color: #121212; --surface-color: #1e1e1e; --text-color: #e0e0e0; }
        html.dark-mode[data-theme='tech-noir'] { --bg-color: #0f0f1e; --surface-color: #1a1a2e; }
        html.dark-mode[data-theme='corporate-blue'] { --text-color: #d0d5dd; }

        /* --- Header & Navigation --- */
        .main-header { display: flex; justify-content: space-between; align-items: center; padding: 1rem 2rem; background: var(--surface-color); box-shadow: 0 2px 10px rgba(0,0,0,0.1); border-bottom: 3px solid var(--primary-color); transition: background-color var(--transition-speed), color var(--transition-speed); z-index: 100; position: relative; }
        .logo-container { display: flex; align-items: center; gap: 0.75rem; }
        .logo-icon-3d { font-size: 2rem; color: var(--primary-color); text-shadow: 1px 1px 0px var(--secondary-color), 2px 2px 0px rgba(0,0,0,0.1); transform: rotateY(10deg) rotateX(-5deg); transition: color var(--transition-speed), text-shadow var(--transition-speed); }
        .logo-container h1 { font-size: 1.75rem; font-weight: 700; margin: 0; color: var(--text-color); }
        .main-nav { display: flex; align-items: center; gap: 1.5rem; }
        .nav-link { text-decoration: none; color: var(--text-color); font-weight: 600; position: relative; transition: color var(--transition-speed); }
        .nav-link::after { content: ''; position: absolute; width: 0; height: 2px; bottom: -5px; left: 0; background-color: var(--primary-color); transition: width var(--transition-speed); }
        .nav-link:hover { color: var(--primary-color); }
        .nav-link:hover::after { width: 100%; }
        .theme-selector { display: flex; align-items: center; gap: 0.5rem; }
        #theme-picker { padding: 0.25rem 0.5rem; border-radius: 5px; border: 1px solid var(--primary-color); background: var(--surface-color); color: var(--text-color); font-family: 'Poppins', sans-serif; }
        #dark-mode-toggle { background: none; border: none; cursor: pointer; font-size: 1.25rem; color: var(--text-color); padding: 0.5rem; }
        #dark-mode-toggle .fa-sun { display: none; }
        html.dark-mode #dark-mode-toggle .fa-sun { display: inline; }
        html.dark-mode #dark-mode-toggle .fa-moon { display: none; }

        /* --- Tool Navigation Dropdown --- */
        .tool-nav { display: flex; gap: 1rem; margin-left: 2rem; }
        .tool-nav-item { position: relative; }
        .tool-nav-button { background: none; border: none; color: var(--text-color); font-family: 'Poppins', sans-serif; font-weight: 600; font-size: 1rem; cursor: pointer; padding: 0.5rem 0.75rem; border-radius: 4px; transition: all var(--transition-speed); }
        .tool-nav-button:hover { color: var(--primary-color); background-color: color-mix(in srgb, var(--primary-color) 10%, transparent); }
        .tool-dropdown { position: absolute; top: 100%; left: 0; background-color: var(--surface-color); box-shadow: 0 5px 15px rgba(0,0,0,0.1); border-radius: 0 0 8px 8px; min-width: 200px; display: none; z-index: 1000; padding: 0.5rem 0; border-top: 2px solid var(--primary-color); }
        .tool-nav-item:hover .tool-dropdown { display: block; }
        .tool-dropdown a { display: block; padding: 0.5rem 1rem; color: var(--text-color); text-decoration: none; transition: background-color var(--transition-speed); }
        .tool-dropdown a:hover { background-color: color-mix(in srgb, var(--primary-color) 10%, transparent); }

        /* --- Login/Signup Button --- */
        .auth-buttons { display: flex; gap: 0.5rem; }
        .auth-button { padding: 0.5rem 1rem; border-radius: 4px; font-weight: 600; cursor: pointer; transition: all var(--transition-speed); }
        .login-button { background: none; border: 1px solid var(--primary-color); color: var(--primary-color); }
        .login-button:hover { background-color: var(--primary-color); color: white; }
        .signup-button { background-color: var(--primary-color); border: 1px solid var(--primary-color); color: white; }
        .signup-button:hover { background-color: var(--secondary-color); border-color: var(--secondary-color); }

        /* --- Tool Specific Styles --- */
        .tool-container { padding: 2rem 4rem; max-width: 900px; margin: auto; }
        /* ===== START: AD BOX STYLES ===== */
        .ad-placeholder-box {
            width: 728px;
            max-width: 100%; /* Ensure it doesn't overflow on smaller containers */
            min-height: 90px;
            background-color: #f0f0f0;
            border: 1px dashed #ccc;
            margin: 0 auto 2rem auto; /* top, horizontal-auto, bottom, horizontal-auto */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #888;
            font-family: Arial, sans-serif;
            border-radius: 8px;
        }
        .ad-placeholder-box .ad-text {
            font-size: 1rem;
            font-weight: bold;
        }
        .ad-placeholder-box .ad-size {
            font-size: 0.8rem;
            margin-top: 4px;
        }
        html.dark-mode .ad-placeholder-box {
            background-color: #2a2a2a;
            border-color: #444;
            color: #aaa;
        }
        /* ===== END: AD BOX STYLES ===== */

        .tool-header h2 { font-size: 2.5rem; margin-bottom: 0.5rem; text-align: center; }
        .tool-header p { font-size: 1.1rem; color: #6c757d; text-align: center; margin-bottom: 2rem; }
        html.dark-mode .tool-header p { color: #a0a0a0; }
        #dropzone { border: 3px dashed #ccc; border-radius: 15px; padding: 3rem; text-align: center; cursor: pointer; background-color: var(--surface-color); transition: background-color var(--transition-speed), border-color var(--transition-speed); }
        #dropzone:hover { border-color: var(--primary-color); }
        #dropzone i { font-size: 3rem; color: var(--primary-color); margin-bottom: 1rem; }
        #processing-panel { margin-top: 2rem; padding: 2rem; background: var(--surface-color); border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: flex; flex-direction: column; gap: 1.5rem; align-items: center; }
        .file-info-card { font-weight: 600; font-size: 1.1rem; color: var(--text-color); background: var(--bg-color); padding: 0.75rem 1.5rem; border-radius: 8px; width: 100%; text-align: center; word-break: break-all; }
        .action-button { display: inline-flex; align-items: center; justify-content: center; gap: 0.75rem; width: 100%; max-width: 500px; padding: 1rem; font-size: 1.25rem; font-weight: 600; color: white; background: var(--gradient); border: none; border-radius: 8px; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
        .action-button:disabled { background: #ccc; cursor: not-allowed; }
        .action-button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .progress-container { width: 100%; max-width: 500px; text-align: center; }
        .progress-bar { width: 100%; height: 20px; background-color: var(--bg-color); border-radius: 10px; overflow: hidden; border: 1px solid #ccc; margin-top: 1rem; }
        .progress-bar-fill { width: 0%; height: 100%; background: var(--gradient); transition: width 0.4s ease-out; }
        #progress-text { font-weight: 600; color: var(--primary-color); margin-bottom: 0.5rem; font-size: 1rem; }
        .quote-container { margin-top: 1.5rem; padding: 1rem; background: var(--bg-color); border-left: 4px solid var(--accent-color); width: 100%; max-width: 500px; }
        .quote-container p { margin: 0; font-style: italic; color: #6c757d; transition: opacity 0.5s ease-in-out; }
        html.dark-mode .quote-container p { color: #a0a0a0; }
        .quote-fade { opacity: 0; }
        
        .navigation-buttons { display: flex; justify-content: center; align-items: center; gap: 1rem; text-align: center; margin-top: 3rem; }
        .nav-btn { display: inline-block; padding: 0.8rem 2.5rem; text-decoration: none; border-radius: 8px; font-weight: 600; font-size: 1.1rem; }
        .primary-nav-btn { background: var(--gradient); color: white !important; }
        .back-secondary-btn { background: transparent; color: var(--primary-color) !important; border: 2px solid var(--primary-color); }
        /* --- Page Transition Animations --- */
        body { animation: fadeInPage 0.5s ease-in-out; }
        .fade-out { animation: fadeOutPage 0.4s ease-in-out forwards; }
        @keyframes fadeInPage { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeOutPage { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(10px); } }
        @keyframes fadeInModal { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* --- User Profile Dropdown and Auth Overlay --- */
        .user-profile-wrapper {
            display: none; /* Controlled by JS */
            align-items: center;
            margin-left: 1.5rem; /* Added for consistent spacing within main-nav */
        }

        #user-icon-button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.25rem;
            color: var(--primary-color);
            padding: 0.5rem;
            border-radius: 50%; /* Make it round */
            transition: background-color var(--transition-speed);
        }
        #user-icon-button:hover {
            background-color: color-mix(in srgb, var(--primary-color) 15%, transparent);
        }

        #user-dropdown {
            display: none; /* Hidden by default, shown on click */
            position: absolute;
            right: 2rem; /* Matches the padding of .main-header */
            top: calc(100% + 10px); /* Position below the header */
            background-color: var(--surface-color);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-radius: 8px;
            min-width: 220px; /* Increased min-width for email */
            max-width: 280px; /* Maximum width to prevent excessive growth */
            z-index: 1000;
            padding: 0.5rem 0;
            border-top: 2px solid var(--primary-color);
            word-wrap: break-word; /* Allows long emails to wrap within the dropdown */
            left: auto; /* Allows it to expand left naturally */
        }
        #user-dropdown.show-dropdown {
            display: block;
        }
        #user-display-dropdown {
            font-weight: 600;
            padding: 0.75rem 1rem; /* Consistent padding */
            color: var(--text-color);
            border-bottom: 1px solid var(--bg-color);
            margin-bottom: 0.5rem;
        }
        #user-dropdown #logout-button {
            width: calc(100% - 2rem); /* Adjusted for dropdown internal padding */
            margin: 0.5rem 1rem; /* Centered with vertical spacing */
        }


        /* --- Overlay for Protected Content (BLOCKING FUNCTIONALITY) --- */
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* Dark semi-transparent background */
            backdrop-filter: blur(5px); /* Blur effect */
            z-index: 2000; /* Ensure it's above everything else */
            display: flex; /* IMPORTANT: Hide by default */
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .auth-overlay.show-overlay {
            opacity: 1;
            visibility: visible;
        }
        .auth-prompt-modal {
            background-color: var(--surface-color);
            padding: 40px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 450px;
            width: 90%;
            border-top: 5px solid var(--primary-color);
            animation: slideIn 0.4s ease-out; /* Reuse existing animation */
        }
        .auth-prompt-modal h2 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-size: 1.8rem;
        }
        .auth-prompt-modal p {
            font-size: 1.1rem;
            color: var(--text-color);
            margin-bottom: 2rem;
        }
        .auth-prompt-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
        }
        .auth-prompt-buttons .auth-button {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
        }
        
        /* --- Password Input Wrapper (no toggle button) --- */
        .password-input-wrapper {
            position: relative; 
            margin-bottom: 1rem;
        }
        /* Standard padding for input fields when no toggle is present */
        .password-input-wrapper input {
            padding-right: 0.75rem !important; /* Default padding */
        }

        /* --- Styling for Forgot Password Link --- */
        #forgot-password-link {
            color: var(--primary-color);
            font-size: 0.9em;
            text-decoration: none;
            display: block; 
            text-align: right;
            margin-top: -0.5rem; 
            margin-bottom: 1rem; 
            transition: color var(--transition-speed);
        }
        #forgot-password-link:hover {
            color: var(--secondary-color);
            text-decoration: underline;
        }

        /* --- Social Login Buttons --- */
        .social-login-buttons {
            display: flex;
            flex-direction: column; /* Stack vertically */
            gap: 10px;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
        }

        .social-button {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1rem;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-speed);
            border: 1px solid #ccc; /* Default border */
            background-color: var(--surface-color);
            color: var(--text-color);
            text-decoration: none; /* For the link element */
        }

        .social-button i {
            margin-right: 0.75rem;
            font-size: 1.2em;
        }

        .google-button {
            background-color: #DB4437; /* Google red */
            color: white;
            border-color: #DB4437;
        }
        .google-button:hover {
            background-color: #c0392b;
            border-color: #c0392b;
        }

        /* --- Separator Style --- */
        .separator {
            display: flex;
            align-items: center;
            text-align: center;
            color: #888;
            margin: 1.5rem 0 1rem 0; /* Adjust spacing */
        }
        .separator::before,
        .separator::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid #ddd;
        }
        .separator:not(:empty)::before {
            margin-right: .75em;
        }
        .separator:not(:empty)::after {
            margin-left: .75em;
        }

        /* --- Prevent scrolling when overlay is active --- */
        body.body-no-scroll {
            overflow: hidden !important;
        }

        /* --- Modals (About, Contact, Login, Signup) --- */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 2000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.7); /* Black w/ opacity */
            justify-content: center; /* Center horizontally */
            align-items: center; /* Center vertically */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal.show-modal {
            display: flex; /* Use flex to center content */
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--surface-color);
            margin: auto; /* For browsers that don't support flex centering */
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 500px;
            position: relative;
            animation: slideIn 0.4s ease-out; /* Reuse existing animation */
            border-top: 5px solid var(--primary-color); /* Add a border top for style */
        }
        
        .modal-content h2 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-size: 1.8rem;
            text-align: center;
        }
        .modal-content p {
            font-size: 1rem;
            color: var(--text-color);
            line-height: 1.5;
            text-align: center;
        }

        .close-btn {
            color: var(--text-color);
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-btn:hover,
        .close-btn:focus {
            color: var(--primary-color);
            text-decoration: none;
        }

        .contact-email {
            display: block;
            text-align: center;
            margin-top: 1rem;
            padding: 0.75rem 1.5rem;
            background-color: var(--primary-color);
            color: white !important; /* Ensure text is white */
            text-decoration: none;
            border-radius: 5px;
            transition: background-color var(--transition-speed);
            max-width: 250px; /* Limit width */
            margin-left: auto;
            margin-right: auto;
        }
        .contact-email:hover {
            background-color: var(--secondary-color);
        }

        /* --- Responsive Design --- */
        @media (max-width: 1024px) {
            .main-header { flex-direction: column; gap: 1rem; padding: 1rem; }
            .tool-nav { margin-left: 0; flex-wrap: wrap; justify-content: center; }
            .tool-container { padding: 2rem 1.5rem; }
            #user-dropdown { /* Adjust for smaller header padding when header stacks */
                right: 1rem; 
            }
        }
        @media (max-width: 768px) {
            .main-nav { flex-wrap: wrap; justify-content: center; }
            .tool-nav { gap: 0.5rem; }
            .tool-nav-button { font-size: 0.9rem; padding: 0.4rem 0.6rem; }
            .auth-buttons { margin-top: 0.5rem; }
            /* Adjust dropdown position for very narrow screens */
            #user-dropdown {
                right: 1rem; /* A bit closer to the edge on small screens, relative to header padding */
                left: auto; /* Ensure it floats right */
                max-width: calc(100vw - 2rem); /* Max width of viewport minus small padding on each side */
                min-width: 150px; /* Ensure it doesn't get too small */
            }
            /* Make ad box responsive */
            .ad-placeholder-box {
                width: 100%;
                min-height: 100px;
            }
        }
    </style>
</head>
<body>
    <!-- Header Section -->
    <header class='main-header'>
        <div style="display: flex; align-items: center;">
            <div class='logo-container'>
                <a href='../../' style='text-decoration: none; color: inherit; display: flex; align-items: center; gap: 0.75rem;'>
                    <div class='logo-icon-3d'><i class='fa-solid fa-cube'></i></div>
                    <h1>JKM Edit - By M&M</h1>
                </a>
            </div>
            
            <!-- Tool Navigation -->
            <nav class='tool-nav'>
                <div class='tool-nav-item'>
                    <button class='tool-nav-button'>PDF Tools</button>
                    <div class='tool-dropdown'>
                        <a href='./merge-pdf.html'>Merge PDF</a>
                        <a href='./split-pdf.html'>Split PDF</a>
                        <a href='./compress-pdf.html'>Compress PDF</a>
                        <a href='./pdf-to-ocr-word.html'>PDF to Word</a>
                        <a href='./pdf-to-powerpoint.html'>PDF to Power Point</a>
                        <a href='./pdf-to-excel.html'>PDF to Excel</a>
                        <a href='./pdf-to-image.html'>PDF to JPG/PNG</a>
                        <a href='./word-to-pdf.html'>Word to PDF</a>
                        <a href='./powerpoint-to-pdf.html'>Powerpoint to PDF</a>
                        <a href='./excel-to-pdf.html'>Excel to PDF</a>
                        <a href='./image-to-pdf.html'>JPG/PNG to PDF</a>
                        <a href='./sign-pdf.html'>Sign PDF</a>
                        <a href='./add-page-numbers.html'>Add Page Numbers</a>
                        <a href='./rotate-pdf.html'>Rotate PDF</a>
                        <a href='./protect-pdf.html'>Protect PDF</a>
                    </div>
                </div>
                
                <div class='tool-nav-item'>
                    <button class='tool-nav-button'>Video Tools</button>
                    <div class='tool-dropdown'>
                        <a href='../../Video-Tools.html#function1'>Trim/Cut Video</a>
                        <a href='../../Video-Tools.html#function2'>Merge Video</a>
                        <a href='../../Video-Tools.html#function3'>Video to MP3</a>
                        <a href='../../Video-Tools.html#function4'>Video Compressor</a>
                        <a href='../../Video-Tools.html#function5'>Video to GIF Convertor</a>
                        <a href='../../Video-Tools.html#function6'>Add Subtitles to Video</a>
                        <a href='../../Video-Tools.html#function7'>Change Video Speed</a>
                        <a href='../../Video-Tools.html#function8'>Video to Image Frames</a>
                        <a href='../../Video-Tools.html#function9'>Other Tools</a>
                    </div>
                </div>
                
                <div class='tool-nav-item'>
                    <button class='tool-nav-button'>Files Tools</button>
                    <div class='tool-dropdown'>
                        <a href='../../File-Tools.html#function1'>File Convertor</a>
                        <a href='../../File-Tools.html#function2'>ZIP/RAR Creator & Extrator</a>
                        <a href='../../File-Tools.html#function3'>File Splitter & Joiner</a>
                        <a href='../../File-Tools.html#function4'>Batch Rename File</a>
                        <a href='../../File-Tools.html#function5'>File Size Reducer</a>
                        <a href='../../File-Tools.html#function6'>Secure File Share</a>
                    </div>
                </div>
                
                <div class='tool-nav-item'>
                    <button class='tool-nav-button'>Utilities</button>
                    <div class='tool-dropdown'>
                        <a href='../../Utilities/Text-Case-Converter.html'>Text Case Converter</a>
                        <a href='../../Utilities/Income-Expenses-Tracker.html'>Income & Expenses Tracker</a>
                        <a href='../../Utilities/Calculator.html'>Calculator</a>
                        <a href='../../Utilities/qr-code-generator.html'>QR Code Generator & Extrater</a>
                        <a href='../../Utilities.html#function5'>Barcode Generator</a>
                        <a href='../../Utilities/currency-converter.html'>Currency Converter</a>
                        <a href='../../Utilities.html#function7'>Online Notepad/Clipboard</a>
                        <a href='../../Utilities.html#function8'>Screen Recoder</a>
                        <a href='../../Utilities.html#function9'>Unit Converter</a>
                    </div>
                </div>
            </nav>
        </div>
        
        <nav class='main-nav'>
            <div class='theme-selector'>
                <label for='theme-picker'>Theme:</label>
                <select id='theme-picker'>
                    <option value='corporate-blue' selected='selected'>Corporate Blue</option>
                    <option value='forest-green'>Forest Green</option>
                    <option value='sunset-gradient'>Sunset Gradient</option>
                    <option value='tech-noir'>Tech Noir</option>
                    <option value='minty-fresh'>Minty Fresh</option>
                    <option value='royal-purple'>Royal Purple</option>
                    <option value='graphite-gray'>Graphite Gray</option>
                    <option value='crimson-red'>Crimson Red</option>
                </select>
            </div>
            <button id='dark-mode-toggle' class='nav-button' aria-label='Toggle Dark Mode'>
                <i class='fa-solid fa-moon'></i><i class='fa-solid fa-sun'></i>
            </button>
            <a href='#' id='about-btn' class='nav-link'>About</a>
            <a href='#' id='contact-btn' class='nav-link'>Contact Us</a>
            
            <!-- User Profile and Logout Dropdown -->
            <div class='user-profile-wrapper'>
                <button id='user-icon-button' class='nav-button' aria-label='User Account'>
                    <i class='fa-solid fa-user'></i>
                </button>
                <div id='user-dropdown' class='tool-dropdown'>
                    <span id="user-display-dropdown"></span>
                    <button id='logout-button' class='auth-button signup-button' style='width: calc(100% - 2rem); margin: 0.5rem 1rem;'>Logout</button>
                </div>
            </div>
            <!-- Login/Signup Buttons (visible when not logged in) -->
            <div class='auth-buttons'>
                <button id='header-login-btn' class='auth-button login-button'>Login</button>
                <button id='header-signup-btn' class='auth-button signup-button'>Sign Up</button>
            </div>
        </nav>
    </header>

    <main class='tool-container'>

        <!-- ===== START: AD BOX PLACEHOLDER ===== -->
        <div class="ad-placeholder-box">
            <span class="ad-text"><script type="text/javascript">
	atOptions = {
		'key' : 'ee4e31cf24b130732767b94f62d603a1',
		'format' : 'iframe',
		'height' : 90,
		'width' : 728,
		'params' : {}
	};
</script>
<script type="text/javascript" src="//www.highperformanceformat.com/ee4e31cf24b130732767b94f62d603a1/invoke.js"></script></span>
        </div>
        <!-- ===== END: AD BOX PLACEHOLDER ===== -->

        <div id="upload-stage">
            <div class='tool-header'>
                <h2>PDF to Word Converter</h2>
                <p>Convert your PDFs (max 5 pages) & images into perfectly formatted Word documents.</p>
            </div>
            <input type="file" id="file-input" class="hidden" accept=".pdf,.png,.jpg,.jpeg,.tiff"/>
            <div id="dropzone">
                <i class="fa-solid fa-file-arrow-up"></i>
                <p id="dropzone-text">Drag & drop PDF (max 5 pages) or Image here</p>
            </div>
        </div>

        <div id="processing-panel" class="hidden">
             <!-- Content generated by JavaScript -->
        </div>
        
        <div class="navigation-buttons">
            <a href="../pdf-tools.html" class="nav-btn back-secondary-btn"><i class="fa-solid fa-arrow-left"></i> Go Back</a>
            <a href="../../" class="nav-btn primary-nav-btn"><i class="fa-solid fa-table-columns"></i> Dashboard</a>
        </div>
    </main>
    
    <!-- Modals (About, Contact, Login, Signup) -->
    <div id='about-modal' class='modal'><div class='modal-content'><span class='close-btn'>×</span><h2>About JKM Edit</h2><p>JKM Edit is your all-in-one solution for online file manipulation.</p></div></div>
    <div id='contact-modal' class='modal'><div class='modal-content'><span class='close-btn'>×</span><h2>Contact Us</h2><p>You can email us directly at:</p><a href='mailto:Mpurohit2414@gmail.com' class='contact-email'>Mpurohit2414@gmail.com</a></div></div>

    <!-- Login Modal -->
    <div id='login-modal' class='modal'>
        <div class='modal-content'>
            <span class='close-btn login-close-btn'>×</span>
            <h2>Login to JKM Edit</h2>
            <div class="social-login-buttons">
                <button type="button" id="google-login-btn" class="social-button google-button">
                    <i class="fab fa-google"></i> Sign in with Google
                </button>
            </div>
            <div class="separator">OR</div>
            <form id='login-form'>
                <div style='margin-bottom: 1rem;'>
                    <label for='login-email' style='display: block; margin-bottom: 0.5rem; color: var(--text-color);'>Email:</label>
                    <input type='email' id='login-email' placeholder='Enter your email' required
                           style='width: 100%; padding: 0.75rem; border: 1px solid #ccc; border-radius: 4px; background-color: var(--bg-color); color: var(--text-color);'>
                </div>
                <div class="password-input-wrapper">
                    <label for='login-password' style='display: block; margin-bottom: 0.5rem; color: var(--text-color);'>Password:</label>
                    <input type='password' id='login-password' placeholder='Enter your password' required
                           style='width: 100%; padding: 0.75rem; border: 1px solid #ccc; border-radius: 4px; background-color: var(--bg-color); color: var(--text-color);'>
                </div>
                <p style="text-align: right; margin-top: -0.5rem; margin-bottom: 1rem;">
                    <a href="#" id="forgot-password-link" style="color: var(--primary-color); font-size: 0.9em; text-decoration: none;">Forgot password?</a>
                </p>
                <button type='submit' class='contact-email' style='width: 100%; border: none;'>Login</button>
                <p id="login-error-message" style="color: red; margin-top: 1rem; display: none;"></p>
            </form>
            <p style="margin-top: 1rem; text-align: center;">Don't have an account? <a href="#" id="open-signup-from-login" style="color: var(--primary-color);">Sign Up</a></p>
        </div>
    </div>

    <!-- Signup Modal -->
    <div id='signup-modal' class='modal'>
        <div class='modal-content'>
            <span class='close-btn signup-close-btn'>×</span>
            <h2>Create an Account</h2>
            <div class="social-login-buttons">
                <button type="button" id="google-signup-btn" class="social-button google-button">
                    <i class="fab fa-google"></i> Sign up with Google
                </button>
            </div>
            <div class="separator">OR</div>
            <form id='signup-form'>
                <div style='margin-bottom: 1rem;'>
                    <label for='signup-name' style='display: block; margin-bottom: 0.5rem; color: var(--text-color);'>Name:</label>
                    <input type='text' id='signup-name' placeholder='Enter your name' required
                           style='width: 100%; padding: 0.75rem; border: 1px solid #ccc; border-radius: 4px; background-color: var(--bg-color); color: var(--text-color);'>
                </div>
                <div style='margin-bottom: 1rem;'>
                    <label for='signup-email' style='display: block; margin-bottom: 0.5rem; color: var(--text-color);'>Email:</label>
                    <input type='email' id='signup-email' placeholder='Enter your email' required
                           style='width: 100%; padding: 0.75rem; border: 1px solid #ccc; border-radius: 4px; background-color: var(--bg-color); color: var(--text-color);'>
                </div>
                <div class="password-input-wrapper">
                    <label for='signup-password' style='display: block; margin-bottom: 0.5rem; color: var(--text-color);'>Password:</label>
                    <input type='password' id='signup-password' placeholder='Create a password (min 6 characters)' required
                           style='width: 100%; padding: 0.75rem; border: 1px solid #ccc; border-radius: 4px; background-color: var(--bg-color); color: var(--text-color);'>
                </div>
                <div class="password-input-wrapper">
                    <label for='signup-confirm-password' style='display: block; margin-bottom: 0.5rem; color: var(--text-color);'>Confirm Password:</label>
                    <input type='password' id='signup-confirm-password' placeholder='Confirm your password' required
                           style='width: 100%; padding: 0.75rem; border: 1px solid #ccc; border-radius: 4px; background-color: var(--bg-color); color: var(--text-color);'>
                </div>
                <button type='submit' class='contact-email' style='width: 100%; border: none;'>Sign Up</button>
                <p id="signup-error-message" style="color: red; margin-top: 1rem; display: none;"></p>
            </form>
            <p style="margin-top: 1rem; text-align: center;">Already have an account? <a href="#" id="open-login-from-signup" style="color: var(--primary-color);">Login</a></p>
        </div>
    </div>


    <script>
        // FIX FOR BFCACHE: This ensures the page is visible when navigating back.
        window.addEventListener('pageshow', function (event) {
            // event.persisted is true if the page was restored from the back-forward cache.
            if (event.persisted) {
                // Remove the fade-out class to make the page visible again.
                document.body.classList.remove('fade-out');
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            // --- Header and General Modal Logic ---
            const aboutModal = document.getElementById('about-modal');
            const contactModal = document.getElementById('contact-modal');
            const aboutBtn = document.getElementById('about-btn');
            const contactBtn = document.getElementById('contact-btn');
            const allCloseBtns = document.querySelectorAll('.close-btn');

            // Elements for auth modals
            const loginModal = document.getElementById('login-modal');
            const signupModal = document.getElementById('signup-modal');
            const headerLoginBtn = document.getElementById('header-login-btn');
            const headerSignupBtn = document.getElementById('header-signup-btn');
            const logoutButton = document.getElementById('logout-button');

            const loginForm = document.getElementById('login-form');
            const loginEmailInput = document.getElementById('login-email');
            const loginPasswordInput = document.getElementById('login-password');
            const loginErrorMessage = document.getElementById('login-error-message');

            const signupForm = document.getElementById('signup-form');
            const signupNameInput = document.getElementById('signup-name');
            const signupEmailInput = document.getElementById('signup-email');
            const signupPasswordInput = document.getElementById('signup-password');
            const signupConfirmPasswordInput = document.getElementById('signup-confirm-password');
            const signupErrorMessage = document.getElementById('signup-error-message');

            const forgotPasswordLink = document.getElementById('forgot-password-link');
            
            // New Google Sign-in Buttons
            const googleLoginBtn = document.getElementById('google-login-btn');
            const googleSignupBtn = document.getElementById('google-signup-btn');


            // Helper function to open/close modals
            const openModal = (modal) => { 
                modal.classList.add('show-modal'); 
                document.body.classList.add('body-no-scroll'); // Prevent background scrolling
            };
            const closeModal = (modal) => { 
                modal.classList.remove('show-modal'); 
                // Only remove body-no-scroll if no other modal or overlay is open
                if (!document.querySelector('.modal.show-modal') && !document.querySelector('.auth-overlay.show-overlay')) {
                    document.body.classList.remove('body-no-scroll'); 
                }
            };

            // Close button functionality for all modals (using event delegation for simplicity)
            allCloseBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    closeModal(aboutModal);
                    closeModal(contactModal);
                    closeModal(loginModal);
                    closeModal(signupModal);
                    // The authPromptOverlay is created dynamically and managed separately.
                    // It should NOT be closed by a generic close button if the user is unauthenticated.
                });
            });

            // Click outside modal to close (only for about/contact/login/signup modals)
            window.addEventListener('click', (e) => {
                if (e.target === aboutModal) closeModal(aboutModal);
                if (e.target === contactModal) closeModal(contactModal);
                if (e.target === loginModal) closeModal(loginModal);
                if (e.target === signupModal) closeModal(signupModal);
                // DO NOT close authPromptOverlay here, it's explicitly managed by auth state for blocking.
            });

            // Event listeners for About & Contact
            if(aboutBtn) aboutBtn.addEventListener('click', (e) => { e.preventDefault(); openModal(aboutModal); });
            if(contactBtn) contactBtn.addEventListener('click', (e) => { e.preventDefault(); openModal(contactModal); });

            // --- Form Clearing (only errors cleared on open, fields cleared on close) ---
            const clearFormErrors = (formType) => {
                if (formType === 'login') {
                    if (loginErrorMessage) {
                        loginErrorMessage.textContent = ''; // Clear text content
                        loginErrorMessage.style.display = 'none';
                        loginErrorMessage.style.color = 'red'; // Reset color in case it was green from a successful reset email
                    }
                } else if (formType === 'signup') {
                    if (signupErrorMessage) {
                        signupErrorMessage.textContent = ''; // Clear text content
                        signupErrorMessage.style.display = 'none';
                    }
                }
            };

            // New event listeners for header Login/Signup buttons
            if(headerLoginBtn) {
                headerLoginBtn.addEventListener('click', (e) => { 
                    e.preventDefault(); 
                    clearFormErrors('login'); // Only clear errors on open
                    closeModal(signupModal); 
                    openModal(loginModal); 
                });
            }
            if(headerSignupBtn) {
                headerSignupBtn.addEventListener('click', (e) => { 
                    e.preventDefault(); 
                    clearFormErrors('signup'); // Only clear errors on open
                    closeModal(loginModal); 
                    openModal(signupModal); 
                });
            }

            // Switch between login/signup modals
            const openSignupFromLoginLink = document.getElementById('open-signup-from-login');
            if(openSignupFromLoginLink) {
                openSignupFromLoginLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    closeModal(loginModal);
                    clearFormErrors('signup'); // Clear errors
                    openModal(signupModal);
                });
            }

            const openLoginFromSignupLink = document.getElementById('open-login-from-signup');
            if(openLoginFromSignupLink) {
                openLoginFromSignupLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    closeModal(signupModal);
                    clearFormErrors('login'); // Clear errors
                    openModal(loginModal);
                });
            }

            // --- Email Validation Function ---
            const isValidEmail = (email) => {
                const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
                return emailRegex.test(email);
            };

            // --- Firebase Authentication Logic ---
            // Handle Login Form Submission
            if(loginForm) {
                loginForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    clearFormErrors('login');
                    const email = loginEmailInput.value.trim();
                    const password = loginPasswordInput.value;

                    if (!isValidEmail(email)) {
                        loginErrorMessage.textContent = 'Please enter a valid email address format.';
                        loginErrorMessage.style.display = 'block';
                        return;
                    }

                    try {
                        await auth.signInWithEmailAndPassword(email, password);
                        closeModal(loginModal);
                        // hideAuthPrompt() is called by onAuthStateChanged after successful login
                    } catch (error) {
                        console.error('Login Error:', error.message);
                        loginErrorMessage.textContent = `Login failed: ${error.message}`;
                        loginErrorMessage.style.display = 'block';
                    }
                });
            }

            // Handle Signup Form Submission
            if(signupForm) {
                signupForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    clearFormErrors('signup');
                    const name = signupNameInput.value.trim();
                    const email = signupEmailInput.value.trim();
                    const password = signupPasswordInput.value;
                    const confirmPassword = signupConfirmPasswordInput.value;

                    if (name.length === 0) {
                        signupErrorMessage.textContent = 'Please enter your name.';
                        signupErrorMessage.style.display = 'block';
                        return;
                    }
                    if (!isValidEmail(email)) {
                        signupErrorMessage.textContent = 'Please enter a valid email address format.';
                        signupErrorMessage.style.display = 'block';
                        return;
                    }
                    if (password.length < 6) {
                        signupErrorMessage.textContent = 'Password should be at least 6 characters.';
                        signupErrorMessage.style.display = 'block';
                        return;
                    }
                    if (password !== confirmPassword) {
                        signupErrorMessage.textContent = 'Passwords do not match.';
                        signupErrorMessage.style.display = 'block';
                        return;
                    }

                    try {
                        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                        await userCredential.user.updateProfile({ // Save display name
                            displayName: name
                        });
                        closeModal(signupModal);
                        // hideAuthPrompt() is called by onAuthStateChanged after successful signup
                    } catch (error) {
                        console.error('Signup Error:', error.message);
                        signupErrorMessage.textContent = `Signup failed: ${error.message}`;
                        signupErrorMessage.style.display = 'block';
                    }
                });
            }

            // Handle Google Login
            if(googleLoginBtn) {
                googleLoginBtn.addEventListener('click', async () => {
                    clearFormErrors('login');
                    try {
                        await auth.signInWithPopup(googleProvider);
                        closeModal(loginModal);
                        // hideAuthPrompt() is called by onAuthStateChanged after successful Google login
                    } catch (error) {
                        console.error('Google Login Error:', error.message);
                        loginErrorMessage.textContent = `Google login failed: ${error.message}`;
                        loginErrorMessage.style.display = 'block';
                    }
                });
            }

            // Handle Google Signup (can use the same signInWithPopup logic)
            if(googleSignupBtn) {
                googleSignupBtn.addEventListener('click', async () => {
                    clearFormErrors('signup');
                    try {
                        await auth.signInWithPopup(googleProvider);
                        closeModal(signupModal);
                        // hideAuthPrompt() is called by onAuthStateChanged after successful Google signup
                    } catch (error) {
                        console.error('Google Signup Error:', error.message);
                        signupErrorMessage.textContent = `Google signup failed: ${error.message}`;
                        signupErrorMessage.style.display = 'block';
                    }
                });
            }


            // Handle Logout
            const userDropdown = document.getElementById('user-dropdown');
            if(logoutButton) {
                logoutButton.addEventListener('click', async () => {
                    try {
                        await auth.signOut();
                    } catch (error) {
                        console.error('Logout Error:', error.message);
                    }
                    if (userDropdown) userDropdown.classList.remove('show-dropdown'); // Hide dropdown on logout
                });
            }

            // Handle Forgot Password
            if(forgotPasswordLink) {
                forgotPasswordLink.addEventListener('click', async (e) => {
                    e.preventDefault();
                    clearFormErrors('login'); // Clear any existing login errors
                    const email = loginEmailInput.value.trim();

                    if (!email || !isValidEmail(email)) {
                        loginErrorMessage.textContent = 'Please enter your email in the login field above to reset your password.';
                        loginErrorMessage.style.display = 'block';
                        return;
                    }

                    try {
                        await auth.sendPasswordResetEmail(email);
                        loginErrorMessage.style.color = 'green';
                        loginErrorMessage.textContent = `Password reset email sent to ${email}. Please check your inbox.`;
                        loginErrorMessage.style.display = 'block';
                    } catch (error) {
                        console.error('Password Reset Error:', error.message);
                        loginErrorMessage.style.color = 'red';
                        loginErrorMessage.textContent = `Failed to send reset email: ${error.message}`;
                        loginErrorMessage.style.display = 'block';
                    }
                });
            }


            // --- Header UI: User Logo and Dropdown ---
            const userProfileWrapper = document.querySelector('.user-profile-wrapper');
            const userIconButton = document.getElementById('user-icon-button');
            const userDisplayDropdown = document.getElementById('user-display-dropdown');
            const authButtonsDiv = document.querySelector('.auth-buttons'); // Already exists

            if(userIconButton) {
                userIconButton.addEventListener('click', (e) => {
                    e.stopPropagation(); // Prevent click from bubbling to window and closing immediately
                    if (userDropdown) userDropdown.classList.toggle('show-dropdown');
                });
            }

            window.addEventListener('click', (e) => {
                if (userDropdown && userDropdown.classList.contains('show-dropdown') && !userIconButton.contains(e.target) && !userDropdown.contains(e.target)) {
                    userDropdown.classList.remove('show-dropdown');
                }
            });
            
            // --- Protected Content Logic (Strict 2-minute lockout) ---
            const LOCKOUT_THRESHOLD_MS = 2 * 60 * 1000; // 2 minutes in milliseconds
            const LOCKOUT_START_TIME_KEY = 'jkm-edit-lockout-start-time'; // Key for localStorage
            let lockoutTimer; // Holds the setTimeout ID

            // Create the auth prompt overlay dynamically (without a close button)
            const authPromptOverlay = document.createElement('div');
            authPromptOverlay.id = 'auth-prompt-overlay';
            authPromptOverlay.classList.add('auth-overlay');
            authPromptOverlay.innerHTML = `
                <div class='auth-prompt-modal'>
                    <h2>Login Required</h2>
                    <p>Please log in or sign up to continue using JKM Edit and access all our tools.</p>
                    <div class='auth-prompt-buttons'>
                        <button id='prompt-login-btn' class='auth-button login-button'>Login</button>
                        <button id='prompt-signup-btn' class='auth-button signup-button'>Sign Up</button>
                    </div>
                </div>
            `;
            document.body.appendChild(authPromptOverlay); // Append it to the body

            // Get references to buttons inside the dynamically created overlay
            const promptLoginBtn = authPromptOverlay.querySelector('#prompt-login-btn');
            const promptSignupBtn = authPromptOverlay.querySelector('#prompt-signup-btn');
            
            // Add event listeners for the dynamically created buttons
            if(promptLoginBtn) {
                promptLoginBtn.addEventListener('click', () => {
                    // When user clicks "Login" from the lockout prompt, close the prompt and open the login modal
                    authPromptOverlay.classList.remove('show-overlay'); // Directly hide the lockout prompt
                    document.body.classList.remove('body-no-scroll'); // Restore scrolling temporarily
                    clearFormErrors('login'); // Clear errors for login modal
                    openModal(loginModal); // Open the login modal
                });
            }
            if(promptSignupBtn) {
                promptSignupBtn.addEventListener('click', () => {
                    // When user clicks "Sign Up" from the lockout prompt, close the prompt and open the signup modal
                    authPromptOverlay.classList.remove('show-overlay'); // Directly hide the lockout prompt
                    document.body.classList.remove('body-no-scroll'); // Restore scrolling temporarily
                    clearFormErrors('signup'); // Clear errors for signup modal
                    openModal(signupModal); // Open the signup modal
                });
            }

            const showAuthPrompt = () => {
                console.log("Showing authentication prompt."); // Debugging line
                authPromptOverlay.classList.add('show-overlay'); // Directly add 'show-overlay' to display it
                document.body.classList.add('body-no-scroll'); // Prevent scrolling
            };

            const hideAuthPrompt = () => {
                authPromptOverlay.classList.remove('show-overlay'); // Directly remove 'show-overlay' to hide it
                // Only remove body-no-scroll if no other modal or overlay is open
                if (!document.querySelector('.modal.show-modal') && !document.querySelector('.auth-overlay.show-overlay')) {
                    document.body.classList.remove('body-no-scroll'); 
                }
                localStorage.removeItem(LOCKOUT_START_TIME_KEY); // Clear timestamp
                if (lockoutTimer) { // Stop any pending lockout timer
                    clearTimeout(lockoutTimer);
                }
            };

            const startLockoutTimer = (delay) => {
                if (lockoutTimer) {
                    clearTimeout(lockoutTimer);
                }
                lockoutTimer = setTimeout(() => {
                    // Double check if user is still not logged in before showing prompt
                    if (!auth.currentUser) { 
                        showAuthPrompt();
                    }
                }, delay);
            };

            // This function will initialize or resume the lockout timer
            const initializeOrResumeLockout = () => {
                if (auth.currentUser) {
                    hideAuthPrompt(); // User is logged in, ensure no lockout
                    return;
                }

                let lockoutStartTime = localStorage.getItem(LOCKOUT_START_TIME_KEY);
                if (!lockoutStartTime) {
                    // First time unauthenticated user on this page, set start time
                    lockoutStartTime = Date.now().toString();
                    localStorage.setItem(LOCKOUT_START_TIME_KEY, lockoutStartTime);
                    startLockoutTimer(LOCKOUT_THRESHOLD_MS);
                } else {
                    // User has been unauthenticated before, calculate elapsed time
                    const elapsed = Date.now() - parseInt(lockoutStartTime);
                    if (elapsed >= LOCKOUT_THRESHOLD_MS) {
                        showAuthPrompt(); // Immediately show if threshold passed
                    } else {
                        // Resume timer with remaining time
                        startLockoutTimer(LOCKOUT_THRESHOLD_MS - elapsed);
                    }
                }
            };

            // Listen for authentication state changes (this is key for persistent login across pages)
            auth.onAuthStateChanged((user) => {
                if (user) {
                    // User is signed in
                    if (userDisplayDropdown) userDisplayDropdown.textContent = user.displayName || user.email; // Shows name or email
                    if (userProfileWrapper) userProfileWrapper.style.display = 'flex'; // Show user icon and dropdown
                    if (authButtonsDiv) authButtonsDiv.style.display = 'none';    // Hide login/signup buttons
                    hideAuthPrompt(); // Ensure prompt is hidden if user logs in
                } else {
                    // User is signed out
                    if (userProfileWrapper) userProfileWrapper.style.display = 'none'; // Hide user icon and dropdown
                    if (userDropdown) userDropdown.classList.remove('show-dropdown'); // Ensure dropdown is closed
                    if (authButtonsDiv) authButtonsDiv.style.display = 'flex';       // Show login/signup buttons
                    initializeOrResumeLockout(); // Start or resume lockout timer
                }
            });

            // Handle visibility change (tab switching) to account for time spent in other tabs
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    // Tab is hidden, if user is not logged in, pause the timer and save current time
                    if (!auth.currentUser) {
                        if (lockoutTimer) clearTimeout(lockoutTimer);
                        // Update the start time to now, so when they come back, it calculates from this point.
                        // This makes the 2 minutes continuous across hidden state.
                        localStorage.setItem(LOCKOUT_START_TIME_KEY, Date.now().toString()); 
                    }
                } else {
                    // Tab is visible again
                    initializeOrResumeLockout(); // Re-evaluate lockout state
                }
            });

            // Initial check on page load
            initializeOrResumeLockout();

            // --- Theme and Dark Mode Event Listeners ---
            const themePicker = document.getElementById('theme-picker');
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            const htmlElement = document.documentElement;

            const setTheme = (theme) => {
                htmlElement.dataset.theme = theme;
                localStorage.setItem('jkm-edit-theme', theme);
            };

            const enableDarkMode = () => {
                htmlElement.classList.add('dark-mode');
                localStorage.setItem('jkm-edit-mode', 'dark');
            };

            const disableDarkMode = () => {
                htmlElement.classList.remove('dark-mode');
                localStorage.setItem('jkm-edit-mode', 'light');
            };

            if(themePicker) {
                themePicker.addEventListener('change', () => setTheme(themePicker.value));
                const savedTheme = localStorage.getItem('jkm-edit-theme');
                if (savedTheme) {
                    themePicker.value = savedTheme;
                }
            }

            if(darkModeToggle) {
                darkModeToggle.addEventListener('click', () => {
                    htmlElement.classList.contains('dark-mode') ? disableDarkMode() : enableDarkMode();
                });
            }

            // When a modal closes, clear form fields and errors messages
            if(loginModal) {
                loginModal.addEventListener('transitionend', () => {
                    if (!loginModal.classList.contains('show-modal')) { // When modal finishes closing
                        if (loginEmailInput) loginEmailInput.value = '';
                        if (loginPasswordInput) loginPasswordInput.value = '';
                        if (loginPasswordInput) loginPasswordInput.type = 'password';
                        clearFormErrors('login'); // Clear errors and reset color
                        if (!auth.currentUser && !authPromptOverlay.classList.contains('show-overlay')) { // If user is still not logged in, and prompt not shown, show auth prompt again
                            initializeOrResumeLockout(); // Re-check lockout state
                        }
                    }
                });
            }
            if(signupModal) {
                signupModal.addEventListener('transitionend', () => {
                    if (!signupModal.classList.contains('show-modal')) { // When modal finishes closing
                        if (signupNameInput) signupNameInput.value = '';
                        if (signupEmailInput) signupEmailInput.value = '';
                        if (signupPasswordInput) signupPasswordInput.value = '';
                        if (signupConfirmPasswordInput) signupConfirmPasswordInput.value = '';
                        if (signupPasswordInput) signupPasswordInput.type = 'password';
                        if (signupConfirmPasswordInput) signupConfirmPasswordInput.type = 'password';
                        clearFormErrors('signup'); // Clear errors
                        if (!auth.currentUser && !authPromptOverlay.classList.contains('show-overlay')) { // If user is still not logged in, and prompt not shown, show auth prompt again
                            initializeOrResumeLockout(); // Re-check lockout state
                        }
                    }
                });
            }

            // --- Page Transition Logic ---
            document.querySelectorAll('a').forEach(link => {
                const linkUrl = link.getAttribute('href');
                // Only apply fade-out to internal HTML links or directory links, not external or JavaScript links
                if (linkUrl && !linkUrl.startsWith('#') && !linkUrl.startsWith('mailto:') && !linkUrl.startsWith('javascript:')) {
                    // Determine if it's an internal link within your domain
                    const isInternalLink = (new URL(linkUrl, window.location.href)).origin === window.location.origin;

                    if (isInternalLink && !link.target) { // If it's an internal link and not opening in a new tab
                        link.addEventListener('click', function(e) {
                            e.preventDefault(); 
                            document.body.classList.add('fade-out');
                            setTimeout(() => {
                                window.location.href = this.href;
                            }, 400); // Match animation duration
                        });
                    }
                }
            });


            // --- PDF TO WORD LOGIC (DIRECT CONVERSION VERSION) ---
            const fileInput = document.getElementById('file-input');
            const dropzone = document.getElementById('dropzone');
            const uploadStage = document.getElementById('upload-stage');
            const processingPanel = document.getElementById('processing-panel');
            const MAX_PAGES = 5; // Page limit for PDFs

            // THIS IS THE URL OF YOUR RENDER SERVICE.
            const RENDER_API_URL = 'https://jkmedit.onrender.com/convert'; 

            let uploadedFile = null;

            // --- EVENT LISTENERS ---
            if (dropzone) dropzone.addEventListener('click', () => fileInput.click());
            if (fileInput) fileInput.addEventListener('change', e => handleFile(e.target.files[0]));
            if (dropzone) dropzone.addEventListener('dragover', e => { e.preventDefault(); dropzone.style.borderColor = 'var(--primary-color)'; });
            if (dropzone) dropzone.addEventListener('dragleave', () => dropzone.style.borderColor = '#ccc');
            if (dropzone) dropzone.addEventListener('drop', e => {
                e.preventDefault();
                dropzone.style.borderColor = '#ccc';
                handleFile(e.dataTransfer.files[0]);
            });

            /**
             * Validates the selected file (type and page count for PDFs).
             */
            async function handleFile(file) {
                // We only need to check PDFs since LibreOffice handles images directly.
                if (file && file.type === 'application/pdf') {
                    try {
                        const pageCount = await getPdfPageCount(file);
                        if (pageCount > MAX_PAGES) {
                            alert(`PDFs are limited to ${MAX_PAGES} pages. Your file has ${pageCount} pages.`);
                            return; // Stop processing
                        }
                    } catch (error) {
                        alert("Could not read this PDF. It may be protected or corrupt.");
                        return; // Stop processing
                    }
                } else if (!file) {
                    alert("Please select a file.");
                    return;
                }

                // If the file is valid, show the processing panel
                uploadedFile = file;
                if (uploadStage) uploadStage.classList.add('hidden');
                if (processingPanel) processingPanel.classList.remove('hidden');
                if (processingPanel) {
                    processingPanel.innerHTML = `
                        <div class="file-info-card">
                            <i class="fa-solid fa-file-alt"></i> ${uploadedFile.name}
                        </div>
                        <button id="convert-btn" class="action-button">
                            <i class="fa-solid fa-file-word"></i> Convert to Word
                        </button>
                    `;
                }
                const convertBtn = document.getElementById('convert-btn');
                if (convertBtn) convertBtn.addEventListener('click', startConversionProcess);
            }

            /**
             * Uses pdf.js to count the number of pages in a PDF file.
             */
            async function getPdfPageCount(file) {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                return pdf.numPages;
            }

            /**
             * Handles the file upload and conversion process.
             */
            async function startConversionProcess() {
                if (!uploadedFile) return;

                // Update the UI to show progress
                if (processingPanel) {
                    processingPanel.innerHTML = `
                        <div class="progress-container">
                            <p id="progress-text">Uploading and converting, please wait...</p>
                            <div class="progress-bar">
                                <div id="progress-bar-fill" class="progress-bar-fill" style="width: 50%;"></div>
                            </div>
                        </div>
                    `;
                }
                
                const progressBarFill = document.getElementById('progress-bar-fill');
                const progressText = document.getElementById('progress-text');

                const formData = new FormData();
                formData.append('file', uploadedFile);

                try {
                    // Send the file directly to your Render service's /convert endpoint
                    const response = await fetch(RENDER_API_URL, {
                        method: 'POST',
                        body: formData
                    });

                    // Animate the progress bar
                    if (progressBarFill) progressBarFill.style.width = '100%';

                    if (response.ok) {
                        if (progressText) progressText.textContent = 'Conversion Complete! Preparing download...';
                        
                        // Get the converted DOCX file as a binary blob
                        const blob = await response.blob();
                        
                        // Create a temporary link element to trigger the download
                        const link = document.createElement('a');
                        link.href = URL.createObjectURL(blob);
                        
                        // Set the correct filename for the download
                        const originalFilename = uploadedFile.name;
                        const newFilename = originalFilename.split('.').slice(0, -1).join('.') + '.docx';
                        link.download = newFilename;
                        
                        // Click the link to start the download, then remove it
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        URL.revokeObjectURL(link.href);

                        // Show the final "success" UI
                        displaySuccessUI();

                    } else {
                        // If the server responded with an error (e.g., 500)
                        const errorData = await response.json();
                        displayError(errorData.details || errorData.error || 'The conversion failed on the server.');
                    }
                } catch (error) {
                    // If there was a network error (e.g., server is down)
                    console.error('Network or conversion error:', error);
                    displayError('Could not connect to the conversion server. Please try again later.');
                }
            }
            
            /**
             * Displays the success message and download/restart buttons.
             */
            function displaySuccessUI() {
                if (processingPanel) {
                    processingPanel.innerHTML = `
                        <div class="file-info-card" style="border-left: 5px solid var(--primary-color);">
                            <i class="fa-solid fa-check-circle" style="color: #28a745;"></i> Download Started!
                        </div>
                        <p>Your DOCX file has been downloaded.</p>
                        <button id="restart-btn" class="action-button" style="background: var(--secondary-color); margin-top: 1rem;">Convert Another File</button>
                    `;
                }
                const restartBtn = document.getElementById('restart-btn');
                if (restartBtn) restartBtn.addEventListener('click', resetTool);
            }
            
            /**
             * Displays a user-friendly error message.
             */
            function displayError(errorMessage) {
                if (processingPanel) {
                    processingPanel.innerHTML = `
                        <p style="color:red; text-align:center; font-weight:bold;">Conversion Failed</p>
                        <p style="text-align:center; max-width: 400px;">${errorMessage}</p>
                        <button id="retry-btn" class="action-button">Try Another File</button>
                    `;
                }
                const retryBtn = document.getElementById('retry-btn');
                if (retryBtn) retryBtn.addEventListener('click', resetTool);
            }

            /**
             * Resets the UI back to the initial upload state.
             */
            function resetTool() {
                if (uploadStage) uploadStage.classList.remove('hidden');
                if (processingPanel) processingPanel.classList.add('hidden');
                if (processingPanel) processingPanel.innerHTML = '';
                uploadedFile = null;
                if (fileInput) fileInput.value = ''; // Clear the file input

                // Ensure auth prompt is hidden if user chose to reset while logged out
                if (!auth.currentUser) {
                    hideAuthPrompt(); // Ensures the prompt is hidden and timer/lockout state is reset
                    initializeOrResumeLockout(); // Re-starts the lockout timer if applicable
                }
            }
        });
    </script>
</body>
</html>
