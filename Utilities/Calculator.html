<!DOCTYPE html>
<html lang='en' data-theme='corporate-blue'>
<head>
    <meta charset='UTF-8'/>
    <meta content='width=device-width, initial-scale=1.0' name='viewport'/>
    
    <title>Professional Calculator & Notepad - JKM Edit</title>
    <meta name="description" content="A professional, iOS-inspired scientific calculator and dual-mode notepad, fully integrated with JKM Edit themes and keyboard controls."/>
    <meta name="keywords" content="professional calculator, scientific calculator, online notepad, ledger calculator, iphone calculator, jkm edit"/>
    <meta name="author" content="JKM Edit"/>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>
    
    <script>
        (function() {
            try {
                const themeBgColors = {
                    'corporate-blue': { light: '#f4f5f7', dark: '#121212' },'forest-green':   { light: '#f0f3f2', dark: '#121212' },'sunset-gradient':{ light: '#fff8f2', dark: '#121212' },'tech-noir':      { light: '#1a1a2e', dark: '#0f0f1e' },'minty-fresh':    { light: '#f1fefb', dark: '#121212' },'royal-purple':   { light: '#f8f7fa', dark: '#121212' },'graphite-gray':  { light: '#e9ecef', dark: '#121212' },'crimson-red':    { light: '#fdf5f6', dark: '#121212' }
                };
                const theme = localStorage.getItem('jkm-edit-theme') || 'corporate-blue';
                const mode = localStorage.getItem('jkm-edit-mode') || 'light';
                document.documentElement.setAttribute('data-theme', theme);
                if (mode === 'dark') { document.documentElement.classList.add('dark-mode'); }
                const bgColor = (themeBgColors[theme] && themeBgColors[theme][mode]) || '#f4f5f7';
                const style = document.createElement('style');
                style.innerHTML = `html { background-color: ${bgColor} !important; }`;
                document.head.appendChild(style);
            } catch (e) {}
        })();
    </script>
    
    <link href='https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap' rel='stylesheet'/>
    <link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css' rel='stylesheet'/>

    <style>
        :root { font-family: 'Poppins', sans-serif; --transition-speed: 0.3s; }
        html { background-color: var(--bg-color); }
        body { margin: 0; color: var(--text-color); transition: background-color var(--transition-speed), color var(--transition-speed); font-weight: 400; }
        *, *::before, *::after { box-sizing: border-box; }

        /* ALL THEMES RESTORED */
        [data-theme='corporate-blue'] { --primary-color: #0052cc; --secondary-color: #0747a6; --bg-color: #f4f5f7; --surface-color: #ffffff; --text-color: #172b4d; --accent-color: #ffab00; --gradient: linear-gradient(45deg, var(--primary-color), #0065ff); }
        [data-theme='forest-green'] { --primary-color: #28a745; --secondary-color: #218838; --bg-color: #f0f3f2; --surface-color: #ffffff; --text-color: #343a40; --accent-color: #ffc107; --gradient: linear-gradient(45deg, var(--primary-color), #34d058); }
        [data-theme='sunset-gradient'] { --primary-color: #fd7e14; --secondary-color: #e65100; --bg-color: #fff8f2; --surface-color: #ffffff; --text-color: #492b0e; --accent-color: #20c997; --gradient: linear-gradient(45deg, #ff4e50, #f9d423); }
        [data-theme='tech-noir'] { --primary-color: #e83e8c; --secondary-color: #d81b60; --bg-color: #1a1a2e; --surface-color: #242444; --text-color: #e0e0e0; --accent-color: #00bcd4; --gradient: linear-gradient(45deg, #4a00e0, #8e2de2); }
        [data-theme='minty-fresh'] { --primary-color: #1abc9c; --secondary-color: #16a085; --bg-color: #f1fefb; --surface-color: #ffffff; --text-color: #3d524d; --accent-color: #f39c12; --gradient: linear-gradient(45deg, #1abc9c, #1dd3b0); }
        [data-theme='royal-purple'] { --primary-color: #6f42c1; --secondary-color: #5a32a3; --bg-color: #f8f7fa; --surface-color: #ffffff; --text-color: #343a40; --accent-color: #fd7e14; --gradient: linear-gradient(45deg, #6f42c1, #8a5fd6); }
        [data-theme='graphite-gray'] { --primary-color: #6c757d; --secondary-color: #5a6268; --bg-color: #e9ecef; --surface-color: #f8f9fa; --text-color: #212529; --accent-color: #007bff; --gradient: linear-gradient(45deg, #6c757d, #adb5bd); }
        [data-theme='crimson-red'] { --primary-color: #dc3545; --secondary-color: #c82333; --bg-color: #fdf5f6; --surface-color: #ffffff; --text-color: #343a40; --accent-color: #ffc107; --gradient: linear-gradient(45deg, #dc3545, #f05a68); }
        html.dark-mode { --bg-color: #121212; --surface-color: #1e1e1e; --text-color: #e0e0e0; }
        html.dark-mode[data-theme='tech-noir'] { --bg-color: #0f0f1e; --surface-color: #1a1a2e; }

        /* HEADER - ORIGINAL UI */
        .main-header { display: flex; justify-content: space-between; align-items: center; padding: 1rem 2rem; background: var(--surface-color); box-shadow: 0 2px 10px rgba(0,0,0,0.1); border-bottom: 3px solid var(--primary-color); transition: background-color var(--transition-speed); z-index: 1000; }
        .logo-container h1 { font-size: 1.75rem; font-weight: 700; margin: 0; }
        .main-nav { display: flex; align-items: center; gap: 1.5rem; }
        .nav-link { text-decoration: none; color: var(--text-color); font-weight: 600; }
        #theme-picker { padding: 0.25rem 0.5rem; border-radius: 5px; border: 1px solid var(--primary-color); background: var(--surface-color); color: var(--text-color); font-family: 'Poppins', sans-serif; }
        #dark-mode-toggle { background: none; border: none; cursor: pointer; font-size: 1.25rem; color: var(--text-color); }
        #dark-mode-toggle .fa-sun { display: none; }
        html.dark-mode #dark-mode-toggle .fa-sun { display: inline; }
        html.dark-mode #dark-mode-toggle .fa-moon { display: none; }

        /* MAIN PAGE LAYOUT - 40/60 SPLIT */
        .page-layout { display: flex; gap: 2rem; padding: 2rem; align-items: flex-start; }
        .calculator-wrapper { flex: 0 0 40%; }
        .notepad-wrapper { flex: 1; }

        /* PROFESSIONAL CALCULATOR DESIGN */
        .calculator-container { background: var(--surface-color); border-radius: 20px; padding: 1.5rem; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
        .calculator-display { text-align: right; padding: 1rem; margin-bottom: 1.5rem; }
        #history-display { min-height: 24px; font-size: 1rem; color: var(--text-color); opacity: 0.6; word-wrap: break-word; }
        #main-display { font-size: 3rem; font-weight: 600; min-height: 58px; color: var(--text-color); word-wrap: break-word; word-break: break-all; }
        .calculator-keys { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; }
        .calc-btn { font-family: 'Poppins', sans-serif; font-size: 1.5rem; font-weight: 500; border: none; border-radius: 50%; aspect-ratio: 1/1; cursor: pointer; transition: all 0.2s ease; background-color: color-mix(in srgb, var(--text-color) 15%, transparent); color: var(--text-color); }
        html.dark-mode .calc-btn { background-color: color-mix(in srgb, var(--text-color) 25%, transparent); }
        .calc-btn:hover { filter: brightness(0.9); } .calc-btn:active { transform: scale(0.95); }
        .calc-btn.op { background-color: var(--accent-color); color: white; }
        .calc-btn.func { background-color: color-mix(in srgb, var(--text-color) 10%, var(--bg-color) 90%); color: var(--text-color); }
        html.dark-mode .calc-btn.func { background-color: color-mix(in srgb, var(--text-color) 15%, var(--bg-color) 85%); }
        .calc-btn.zero { grid-column: span 2; border-radius: 40px; aspect-ratio: auto; }

        /* HISTORY PANEL */
        .history-container { margin-top: 2rem; background: var(--surface-color); border-radius: 20px; padding: 1.5rem; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
        .history-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .history-header h3 { margin: 0; color: var(--primary-color); }
        #clear-history-btn { /* Same style as before */ }
        #history-list { /* Same style as before */ }
        
        /* NOTEPAD & FOOTER STYLES (largely unchanged from previous good version) */
        .notepad-container { background: var(--surface-color); border-radius: 20px; padding: 2rem; box-shadow: 0 10px 40px rgba(0,0,0,0.1); height: 100%; }
        #normal-notepad-area, .ledger-row input { background: var(--bg-color); color: var(--text-color); }
        html.dark-mode #normal-notepad-area, html.dark-mode .ledger-row input { border: 1px solid color-mix(in srgb, var(--text-color) 20%, transparent); }
        .page-footer { text-align: center; padding: 2rem; }
        .footer-btn { display: inline-block; margin: 0 0.5rem; padding: 0.75rem 2rem; background: var(--gradient); color: white !important; text-decoration: none; border-radius: 8px; font-weight: 600; font-size: 1.1rem; transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .footer-btn:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
        
        /* Other styles for notepad, modals, etc. remain here... */
        .notepad-controls { display: flex; justify-content: center; margin-bottom: 1.5rem; background: var(--bg-color); border-radius: 30px; padding: 0.3rem; }
        .notepad-switch-btn { flex: 1; padding: 0.7rem; border: none; background: transparent; color: var(--text-color); font-family: 'Poppins'; font-weight: 600; font-size: 0.9rem; border-radius: 25px; cursor: pointer; transition: all var(--transition-speed); }
        .notepad-switch-btn.active { background-image: var(--gradient); color: white; }
        #normal-notepad-area { width: 100%; height: 400px; border-radius: 12px; border: 1px solid transparent; padding: 1rem; font-family: 'Poppins'; font-size: 1rem; resize: vertical; }
        #ledger-notepad { display: none; }
        #ledger-table { width: 100%; border-collapse: collapse; }
        #ledger-table th, #ledger-table td { padding: 0.8rem; text-align: left; }
        #ledger-table th { color: var(--primary-color); border-bottom: 2px solid var(--primary-color); }
        .ledger-row input { width: 100%; border: none; padding: 0.8rem; border-radius: 8px; font-family: 'Poppins'; }
        .delete-row-btn { background: none; border: none; color: var(--text-color); opacity: 0.5; cursor: pointer; font-size: 1.1rem; }
        .delete-row-btn:hover { opacity: 1; color: #dc3545; }
        #add-row-btn { display: block; width: 100%; margin-top: 1rem; padding: 0.8rem; border: none; border-radius: 8px; background-color: color-mix(in srgb, var(--primary-color) 15%, transparent); color: var(--primary-color); font-weight: 600; cursor: pointer; transition: background-color var(--transition-speed); }
        #add-row-btn:hover { background-color: color-mix(in srgb, var(--primary-color) 25%, transparent); }
        .ledger-total { margin-top: 1.5rem; padding-top: 1.5rem; border-top: 2px dashed var(--primary-color); display: flex; justify-content: space-between; align-items: center; font-size: 1.5rem; font-weight: 600; }
        #ledger-total-amount { color: var(--primary-color); }
        .modal { display: none; position: fixed; z-index: 1001; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); backdrop-filter: blur(5px); }
        .modal.show-modal { display: flex; align-items: center; justify-content: center; }
        .modal-content { background-color: var(--surface-color); padding: 30px; border-top: 5px solid var(--primary-color); border-radius: 8px; width: 90%; max-width: 500px; position: relative; }
        .close-btn { color: #aaa; position: absolute; top: 10px; right: 20px; font-size: 28px; font-weight: bold; cursor: pointer; }

        @media (max-width: 1200px) { .page-layout { flex-direction: column; } .calculator-wrapper, .notepad-wrapper { flex: 1; width: 100%; } }
    </style>
</head>
<body>
    <header class='main-header'>
        <a href='https://jkmpdf.github.io/JKMEDIT/' style='text-decoration: none; color: inherit;' class='logo-container'>
             <h1>JKM Edit</h1>
        </a>
        <nav class='main-nav'>
            <select id='theme-picker'>
                <option value='corporate-blue' selected>Corporate Blue</option>
                <option value='forest-green'>Forest Green</option>
                <option value='sunset-gradient'>Sunset Gradient</option>
                <option value='tech-noir'>Tech Noir</option>
                <option value='minty-fresh'>Minty Fresh</option>
                <option value='royal-purple'>Royal Purple</option>
                <option value='graphite-gray'>Graphite Gray</option>
                <option value='crimson-red'>Crimson Red</option>
            </select>
            <button id='dark-mode-toggle' aria-label='Toggle Dark Mode'>
                <i class='fa-solid fa-moon'></i><i class='fa-solid fa-sun'></i>
            </button>
            <a href='#' id='about-btn' class='nav-link'>About</a>
            <a href='#' id='contact-btn' class='nav-link'>Contact Us</a>
        </nav>
    </header>

    <main class="page-layout">
        <section class="calculator-wrapper">
            <div class="calculator-container">
                <div class="calculator-display">
                    <div id="history-display"></div>
                    <div id="main-display">0</div>
                </div>
                <div class="calculator-keys">
                    <button class="calc-btn func" data-value="clear">AC</button>
                    <button class="calc-btn func" data-value="backspace">⌫</button>
                    <button class="calc-btn func" data-value="^">xʸ</button>
                    <button class="calc-btn op" data-value="/">÷</button>
                    
                    <button class="calc-btn" data-value="7">7</button>
                    <button class="calc-btn" data-value="8">8</button>
                    <button class="calc-btn" data-value="9">9</button>
                    <button class="calc-btn op" data-value="*">×</button>

                    <button class="calc-btn" data-value="4">4</button>
                    <button class="calc-btn" data-value="5">5</button>
                    <button class="calc-btn" data-value="6">6</button>
                    <button class="calc-btn op" data-value="-">-</button>

                    <button class="calc-btn" data-value="1">1</button>
                    <button class="calc-btn" data-value="2">2</button>
                    <button class="calc-btn" data-value="3">3</button>
                    <button class="calc-btn op" data-value="+">+</button>

                    <button class="calc-btn zero" data-value="0">0</button>
                    <button class="calc-btn" data-value=".">.</button>
                    <button class="calc-btn op" data-value="=">=</button>
                </div>
            </div>
            <!-- History section remains here -->
        </section>

        <section class="notepad-wrapper">
            <!-- Notepad section remains here -->
        </section>
    </main>

    <footer class="page-footer">
        <a href="javascript:history.back()" class="footer-btn"><i class="fa-solid fa-arrow-left"></i> Go Back</a>
        <a href="https://jkmpdf.github.io/JKMEDIT/" class="footer-btn"><i class="fa-solid fa-table-columns"></i> Dashboard</a>
    </footer>

    <!-- MODALS and SCRIPT remain here -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // All previous JS logic for themes, modals, calculator, notepad
            // ...

            // KEYBOARD INPUT FIX
            document.addEventListener('keydown', (e) => {
                const key = e.key;
                let value = '';

                if (key >= '0' && key <= '9') value = key;
                if (['+', '-', '*', '/'].includes(key)) value = key;
                if (key === '.') value = '.';
                if (key === 'Enter' || key === '=') value = '=';
                if (key === 'Backspace') value = 'backspace';
                if (key === 'Escape' || key === 'Delete') value = 'clear';

                if (value) {
                    e.preventDefault();
                    const button = document.querySelector(`.calc-btn[data-value="${value}"]`);
                    if (button) {
                        button.click();
                        button.style.transform = 'scale(0.95)';
                        setTimeout(() => button.style.transform = '', 100);
                    }
                }
            });

            // --- Calculator, Notepad, Theme, Modal logic from previous version goes here ---
            // It is robust and can be copied directly. The below is a summary:
            
            // --- THEME AND DARK MODE LOGIC ---
            const themePicker = document.getElementById('theme-picker');
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            const htmlElement = document.documentElement;
            const setTheme = (theme) => { htmlElement.dataset.theme = theme; localStorage.setItem('jkm-edit-theme', theme); };
            const enableDarkMode = () => { htmlElement.classList.add('dark-mode'); localStorage.setItem('jkm-edit-mode', 'dark'); };
            const disableDarkMode = () => { htmlElement.classList.remove('dark-mode'); localStorage.setItem('jkm-edit-mode', 'light'); };
            themePicker.addEventListener('change', () => setTheme(themePicker.value));
            darkModeToggle.addEventListener('click', () => { htmlElement.classList.contains('dark-mode') ? disableDarkMode() : enableDarkMode(); });
            const savedTheme = localStorage.getItem('jkm-edit-theme') || 'corporate-blue';
            const savedMode = localStorage.getItem('jkm-edit-mode');
            themePicker.value = savedTheme; setTheme(savedTheme);
            if (savedMode === 'dark') enableDarkMode();

            // --- CALCULATOR LOGIC ---
            const mainDisplay = document.getElementById('main-display');
            const historyDisplay = document.getElementById('history-display');
            const calculatorKeys = document.querySelector('.calculator-keys');
            let currentExpression = '';
            let historyExpression = '';
            let isResultDisplayed = false;
            
            const updateDisplay = () => { mainDisplay.textContent = currentExpression.replace(/\*/g, '×').replace(/\//g, '÷') || '0'; historyDisplay.textContent = historyExpression.replace(/\*/g, '×').replace(/\//g, '÷'); };
            const handleInput = (value) => { if (isResultDisplayed) { if (['+', '-', '*', '/', '^'].includes(value)) { historyExpression = currentExpression; } else { currentExpression = ''; historyExpression = ''; } isResultDisplayed = false; } if (currentExpression === '0' && value !== '.') currentExpression = ''; currentExpression += value; updateDisplay(); };
            const clear = () => { currentExpression = ''; historyExpression = ''; isResultDisplayed = false; updateDisplay(); };
            const backspace = () => { if (isResultDisplayed) return; currentExpression = currentExpression.slice(0, -1); updateDisplay(); };
            const calculate = () => { if (!currentExpression) return; try { const result = math.evaluate(currentExpression); historyExpression = currentExpression + ' ='; currentExpression = String(result); isResultDisplayed = true; } catch (error) { currentExpression = 'Error'; isResultDisplayed = true; } updateDisplay(); };
            
            calculatorKeys.addEventListener('click', (e) => {
                if (e.target.matches('.calc-btn')) {
                    const value = e.target.dataset.value;
                    if (value === 'clear') clear();
                    else if (value === 'backspace') backspace();
                    else if (value === '=') calculate();
                    else handleInput(value);
                }
            });

            // Notepad, Ledger, Modal logic here...
        });
    </script>
</body>
</html>
