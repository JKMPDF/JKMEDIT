<!DOCTYPE html>
<html lang='en' data-theme='corporate-blue'>
<head>
    <meta charset='UTF-8'/>
    <meta content='width=device-width, initial-scale=1.0' name='viewport'/>
<title>Pro Calculator with History - JKM Edit</title>
<meta name="description" content="A free, professional scientific calculator with a transparent design, keyboard support, and a persistent history log. Part of the JKM Edit suite."/>
<meta name="keywords" content="online calculator, scientific calculator, pro calculator, calculator with history, keyboard calculator, free tools, jkm edit"/>
<meta name="author" content="JKM Edit"/>
<meta name="robots" content="index, follow"/>
<meta name="google-site-verification" content="Ro_iz55zO9NB6h6tSokRnkEdbj5Z8MQN1Ig6Yrmmh88" />
<meta name="google-adsense-account" content="ca-pub-7398521559513676">
<link rel="canonical" href="https://jkmpdf.github.io/JKMEDIT/Utilities/calculator.html"/>
<meta property="og:title" content="Pro Calculator with History - JKM Edit"/>
<meta property="og:description" content="A free, professional scientific calculator with a transparent design, keyboard support, and a persistent history log."/>
<meta property="og:type" content="website"/>
<meta property="og:url" content="https://jkmpdf.github.io/JKMEDIT/Utilities/calculator.html"/>
<meta property="og:image" content="https://jkmpdf.github.io/JKMEDIT/assets/og-preview-image.png"/>
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:title" content="Pro Calculator with History - JKM Edit"/>
<meta name="twitter:description" content="A free, professional scientific calculator with a transparent design, keyboard support, and a persistent history log."/>
<meta name="twitter:image" content="https://jkmpdf.github.io/JKMEDIT/assets/og-preview-image.png"/>
<link rel="icon" type="image/png" href="../assets/jkm-edit-logo.png">

<script>
    (function() {
        try {
            const theme = localStorage.getItem('jkm-edit-theme') || 'corporate-blue';
            document.documentElement.setAttribute('data-theme', theme);
            const mode = localStorage.getItem('jkm-edit-mode');
            if (mode === 'dark') {
                document.documentElement.classList.add('dark-mode');
            }
        } catch (e) {}
    })();
</script>

<link href='https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap' rel='stylesheet'/>
<link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css' rel='stylesheet'/>

<style>
    /* --- Basic Setup & Variables --- */
    :root { font-family: 'Poppins', sans-serif; --transition-speed: 0.3s; }
    body { margin: 0; background-color: var(--bg-color); color: var(--text-color); transition: background-color var(--transition-speed), color var(--transition-speed); }
    *, *::before, *::after { box-sizing: border-box; }

    /* --- THEME DEFINITIONS --- */
    [data-theme='corporate-blue'] { --primary-color: #0052cc; --secondary-color: #0747a6; --bg-color: #f4f5f7; --surface-color: #ffffff; --text-color: #172b4d; --accent-color: #ffab00; --gradient: linear-gradient(45deg, var(--primary-color), #0065ff); }
    [data-theme='forest-green'] { --primary-color: #28a745; --secondary-color: #218838; --bg-color: #f0f3f2; --surface-color: #ffffff; --text-color: #343a40; --accent-color: #ffc107; --gradient: linear-gradient(45deg, var(--primary-color), #34d058); }
    [data-theme='sunset-gradient'] { --primary-color: #fd7e14; --secondary-color: #e65100; --bg-color: #fff8f2; --surface-color: #ffffff; --text-color: #492b0e; --accent-color: #20c997; --gradient: linear-gradient(45deg, #ff4e50, #f9d423); }
    [data-theme='tech-noir'] { --primary-color: #e83e8c; --secondary-color: #d81b60; --bg-color: #1a1a2e; --surface-color: #242444; --text-color: #e0e0e0; --accent-color: #00bcd4; --gradient: linear-linear-gradient(45deg, #4a00e0, #8e2de2); }
    [data-theme='minty-fresh'] { --primary-color: #1abc9c; --secondary-color: #16a085; --bg-color: #f1fefb; --surface-color: #ffffff; --text-color: #3d524d; --accent-color: #f39c12; --gradient: linear-gradient(45deg, #1abc9c, #1dd3b0); }
    [data-theme='royal-purple'] { --primary-color: #6f42c1; --secondary-color: #5a32a3; --bg-color: #f8f7fa; --surface-color: #ffffff; --text-color: #343a40; --accent-color: #fd7e14; --gradient: linear-gradient(45deg, #6f42c1, #8a5fd6); }
    [data-theme='graphite-gray'] { --primary-color: #6c757d; --secondary-color: #5a6268; --bg-color: #e9ecef; --surface-color: #f8f9fa; --text-color: #212529; --accent-color: #007bff; --gradient: linear-gradient(45deg, #6c757d, #adb5bd); }
    [data-theme='crimson-red'] { --primary-color: #dc3545; --secondary-color: #c82333; --bg-color: #fdf5f6; --surface-color: #ffffff; --text-color: #343a40; --accent-color: #ffc107; --gradient: linear-gradient(45deg, #dc3545, #f05a68); }

    /* --- DARK MODE --- */
    html.dark-mode { --bg-color: #121212; --surface-color: #1e1e1e; --text-color: #e0e0e0; }
    html.dark-mode[data-theme='tech-noir'] { --bg-color: #0f0f1e; --surface-color: #1a1a2e; }
    html.dark-mode[data-theme='corporate-blue'] { --text-color: #d0d5dd; }

    /* --- Header & Navigation --- */
    .main-header { display: flex; justify-content: space-between; align-items: center; padding: 1rem 2rem; background: var(--surface-color); box-shadow: 0 2px 10px rgba(0,0,0,0.1); border-bottom: 3px solid var(--primary-color); transition: background-color var(--transition-speed), color var(--transition-speed); z-index: 100; position: relative; }
    .logo-container { display: flex; align-items: center; gap: 0.75rem; }
    .site-logo { height: 2rem; width: auto; transition: transform var(--transition-speed); }
    .site-logo:hover { transform: scale(1.05); }
    .logo-container h1 { font-size: 1.75rem; font-weight: 700; margin: 0; color: var(--text-color); }
    .main-nav { display: flex; align-items: center; gap: 1.5rem; }
    .theme-selector { display: flex; align-items: center; gap: 0.5rem; }
    #theme-picker { padding: 0.25rem 0.5rem; border-radius: 5px; border: 1px solid var(--primary-color); background: var(--surface-color); color: var(--text-color); font-family: 'Poppins', sans-serif; }
    #dark-mode-toggle { background: none; border: none; cursor: pointer; font-size: 1.25rem; color: var(--text-color); padding: 0.5rem; }
    #dark-mode-toggle .fa-sun { display: none; }
    html.dark-mode #dark-mode-toggle .fa-sun { display: inline; }
    html.dark-mode #dark-mode-toggle .fa-moon { display: none; }
    .tool-nav { display: flex; gap: 1rem; margin-left: 2rem; }
    .tool-nav-item { position: relative; }
    .tool-nav-button { background: none; border: none; color: var(--text-color); font-family: 'Poppins', sans-serif; font-weight: 600; font-size: 1rem; cursor: pointer; padding: 0.5rem 0.75rem; border-radius: 4px; transition: all var(--transition-speed); }
    .tool-nav-button:hover { color: var(--primary-color); background-color: color-mix(in srgb, var(--primary-color) 10%, transparent); }
    .tool-dropdown { position: absolute; top: 100%; left: 0; background-color: var(--surface-color); box-shadow: 0 5px 15px rgba(0,0,0,0.1); border-radius: 0 0 8px 8px; min-width: 200px; display: none; z-index: 1000; padding: 0.5rem 0; border-top: 2px solid var(--primary-color); }
    .tool-nav-item:hover .tool-dropdown { display: block; }
    .tool-dropdown a { display: block; padding: 0.5rem 1rem; color: var(--text-color); text-decoration: none; transition: background-color var(--transition-speed); }
    .tool-dropdown a:hover { background-color: color-mix(in srgb, var(--primary-color) 10%, transparent); }
    .auth-button { padding: 0.5rem 1rem; border-radius: 4px; font-weight: 600; cursor: pointer; transition: all var(--transition-speed); }
    .login-button { background: none; border: 1px solid var(--primary-color); color: var(--primary-color); }
    .login-button:hover { background-color: var(--primary-color); color: white; }

    /* --- Main Dashboard & Content Area --- */
    .dashboard-container { padding: 2rem 4rem; max-width: 1400px; margin: auto; }
    .dashboard-header { text-align: center; margin-bottom: 2rem; }
    .dashboard-header h2 { font-size: 2.5rem; margin-bottom: 0.5rem; }
    .dashboard-header p { font-size: 1.1rem; color: #6c757d; }
    html.dark-mode .dashboard-header p { color: #a0a0a0; }
    
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideIn { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    
    /* --- Responsive Design (Simplified) --- */
    @media (max-width: 1024px) {
        .main-header { flex-direction: column; gap: 1rem; padding: 1rem; }
        .tool-nav { margin-left: 0; flex-wrap: wrap; justify-content: center; }
        .dashboard-container { padding: 2rem 1.5rem; }
    }
    @media (max-width: 768px) {
        .main-nav { flex-wrap: wrap; justify-content: center; }
        .tool-nav { gap: 0.5rem; }
        .tool-nav-button { font-size: 0.9rem; padding: 0.4rem 0.6rem; }
    }

    /* ============================================== */
    /* --- NEW CALCULATOR & HISTORY STYLES --- */
    /* ============================================== */

    .app-wrapper {
        display: grid;
        grid-template-columns: 1fr 300px; /* Main calc | History */
        gap: 2rem;
        min-height: 70vh;
    }
    
    /* --- Glassmorphism Container --- */
    .glass-container {
        background: color-mix(in srgb, var(--surface-color) 70%, transparent);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid color-mix(in srgb, var(--surface-color) 80%, transparent);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
        border-radius: 12px;
        padding: 1.5rem;
    }
    html.dark-mode .glass-container {
        background: color-mix(in srgb, var(--surface-color) 50%, transparent);
        border: 1px solid color-mix(in srgb, var(--surface-color) 70%, transparent);
    }

    /* --- Calculator Styles --- */
    .calculator-container {
        display: flex;
        flex-direction: column;
    }
    
    .calculator-display {
        background: color-mix(in srgb, var(--bg-color) 80%, var(--text-color) 20%);
        color: var(--text-color);
        border-radius: 8px;
        padding: 1.5rem 1rem;
        font-size: 2.5rem;
        font-weight: 600;
        text-align: right;
        margin-bottom: 1rem;
        word-wrap: break-word;
        word-break: break-all;
        min-height: 80px;
        box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }
    html.dark-mode .calculator-display {
         background: color-mix(in srgb, var(--bg-color) 80%, #000 20%);
    }

    /* --- Keypad Structure --- */
    .calculator-keypads {
        display: flex;
        flex-direction: column;
        flex: 1;
        gap: 0.75rem;
    }
    .calculator-keys-sci {
        display: none; /* Hidden by default */
        grid-template-columns: repeat(5, 1fr);
        gap: 0.75rem;
    }
    .calculator-keys-standard {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 0.75rem;
        flex: 1; 
    }
    
    /* Scientific Mode Active */
    .calculator-container.scientific-mode .calculator-keys-sci {
        display: grid;
    }
    
    /* --- Button Styles (Applied to both) --- */
    .calculator-keys-sci button,
    .calculator-keys-standard button {
        background: color-mix(in srgb, var(--surface-color) 80%, var(--bg-color) 20%);
        border: 1px solid transparent;
        color: var(--text-color);
        border-radius: 8px;
        font-size: 1.1rem;
        font-weight: 500;
        padding: 1.25rem 0.5rem;
        cursor: pointer;
        transition: all 0.2s;
        font-family: 'Poppins', sans-serif;
        box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        min-height: 60px; /* Ensure uniform height */
    }

    .calculator-keys-sci button:hover,
    .calculator-keys-standard button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 10px rgba(0,0,0,0.1);
        border-color: var(--primary-color);
    }
    
    .calculator-keys-sci button:active,
    .calculator-keys-standard button:active,
    .calculator-keys-sci button.key-active,
    .calculator-keys-standard button.key-active {
        transform: translateY(0);
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        background-color: color-mix(in srgb, var(--bg-color) 90%, var(--text-color) 10%);
    }

    /* Casio color scheme */
    .key-operator,
    .key-backspace {
        background: color-mix(in srgb, var(--text-color) 15%, var(--surface-color) 85%);
        font-weight: 600;
    }
    .key-sci {
        background: color-mix(in srgb, var(--text-color) 10%, var(--surface-color) 90%);
        font-size: 1rem;
    }
    .key-equals {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
        grid-row: span 2; /* Make equals button tall */
    }
    .key-equals:hover { background: var(--secondary-color); }
    .key-clear {
        background-color: #dc3545;
        color: white;
        border-color: #dc3545;
    }
    .key-clear:hover { background-color: #c82333; }
    .key-span-2 {
        grid-column: span 2;
    }

    /* --- Scientific Mode Toggle --- */
    .calculator-toggle {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        margin-bottom: 1rem;
        font-size: 0.9rem;
    }
    .switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 28px;
    }
    .switch input { display: none; }
    .slider {
        position: absolute;
        cursor: pointer;
        top: 0; left: 0; right: 0; bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 28px;
    }
    .slider:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
    }
    input:checked + .slider {
        background-color: var(--primary-color);
    }
    input:checked + .slider:before {
        transform: translateX(22px);
    }

    /* --- History Panel --- */
    .history-container {
        display: flex;
        flex-direction: column;
        height: 70vh;
    }
    .history-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid color-mix(in srgb, var(--text-color) 20%, transparent);
        padding-bottom: 0.75rem;
        margin-bottom: 1rem;
    }
    .history-header h3 {
        margin: 0;
        color: var(--text-color);
    }
    #clear-history-btn {
        background: none;
        border: 1px solid color-mix(in srgb, var(--text-color) 50%, transparent);
        color: var(--text-color);
        opacity: 0.7;
        font-size: 0.8rem;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s;
    }
    #clear-history-btn:hover {
        opacity: 1;
        background: color-mix(in srgb, var(--text-color) 10%, transparent);
        border-color: var(--text-color);
    }
    #history-list {
        flex: 1;
        margin: 0;
        padding: 0;
        list-style: none;
        overflow-y: auto;
    }
    #history-list li {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        padding: 0.75rem 0.5rem;
        border-bottom: 1px solid color-mix(in srgb, var(--text-color) 10%, transparent);
    }
    #history-list li .history-expression {
        font-size: 0.9rem;
        color: var(--text-color);
        opacity: 0.7;
        word-break: break-all;
    }
    #history-list li .history-result {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--text-color);
        margin-top: 0.25rem;
        word-break: break-all;
    }


    /* --- Responsive for App --- */
    @media (max-width: 1024px) {
        .app-wrapper {
            grid-template-columns: 1fr; /* Stack columns */
            gap: 1.5rem;
        }
        .history-container, .calculator-container {
            height: auto; /* Let content define height */
            min-height: 400px;
        }
        .history-container {
            max-height: 400px; /* Make history scrollable */
        }
    }

</style>
</head>
<body>
    <header class='main-header'>
        <div style="display: flex; align-items: center;">
            <div class='logo-container'>
                <a href='../index.html' style='text-decoration: none; color: inherit; display: flex; align-items: center; gap: 0.75rem;'>
                    <img src='../assets/jkm-edit-logo.png' alt='JKM Edit Logo' class='site-logo'>
                    <h1>JKM Edit - By M&M</h1>
                </a>
            </div>
    <nav class='tool-nav'>
        <div class='tool-nav-item'>
            <button class='tool-nav-button'>PDF Tools</button>
            <div class='tool-dropdown'>
                <a href='../Pdf-tools/merge-pdf.html'>Merge PDF</a>
                <a href='../Pdf-tools/split-pdf.html'>Split PDF</a>
                <a href='../Pdf-tools/compress-pdf.html'>Compress PDF</a>
                <a href='../Pdf-tools/pdf-to-ocr-word.html'>PDF to Word</a>
                <a href='../Pdf-tools/pdf-to-powerpoint.html'>PDF to Power Point</a>
                <a href='../Pdf-tools/pdf-to-excel.html'>PDF to Excel</a>
                <a href='../Pdf-tools/pdf-to-image.html'>PDF to JPG/PNG</a>
                <a href='../Pdf-tools/word-to-pdf.html'>Word to PDF</a>
                <a href='../pdf-tools.html#function9'>Powerpoint to PDF</a>
                <a href='../Pdf-tools/excel-to-pdf.html'>Excel to PDF</a>
                <a href='../Pdf-tools/image-to-pdf.html'>JPG/PNG to PDF</a>
                <a href='../Pdf-tools/sign-pdf.html'>Sign PDF</a>
                <a href='../Pdf-tools/add-page-numbers.html'>Add Page Numbers</a>
                <a href='../Pdf-tools/rotate-pdf.html'>Rotate PDF</a>
                <a href='../Pdf-tools/protect-pdf.html'>Protect PDF</a>
            </div>
        </div>
        
        <div class='tool-nav-item'>
            <button class='tool-nav-button'>Video Tools</button>
            <div class='tool-dropdown'>
                <a href='../Video-Tools.html#function1'>Trim/Cut Video</a>
                <a href='../Video-Tools.html#function2'>Merge Video</a>
                <a href='../Video-Tools.html#function3'>Video to MP3</a>
                <a href='../Video-Tools.html#function4'>Video Compressor</a>
                <a href='../Video-Tools.html#function5'>Video to GIF Convertor</a>
                <a href='../Video-Tools.html#function6'>Add Subtitles to Video</a>
                <a href='../Video-Tools.html#function7'>Change Video Speed</a>
                <a href='../Video-Tools.html#function8'>Video to Image Frames</a>
                <a href='../Video-Tools.html#function9'>Other Tools</a>
            </div>
        </div>
        
        <div class='tool-nav-item'>
            <button class='tool-nav-button'>Files Tools</button>
            <div class='tool-dropdown'>
                <a href='../File-Tools.html#function1'>File Convertor</a>
                <a href='../File-Tools.html#function2'>ZIP/RAR Creator & Extrator</a>
                <a href='../File-Tools.html#function3'>File Splitter & Joiner</a>
                <a href='../File-Tools.html#function4'>Batch Rename File</a>
                <a href='../File-Tools.html#function5'>File Size Reducer</a>
                <a href='../File-Tools.html#function6'>Secure File Share</a>
            </div>
        </div>
        
        <div class='tool-nav-item'>
            <button class='tool-nav-button'>Utilities</button>
            <div class='tool-dropdown'>
                <a href='../Utilities/Text-Case-Converter.html'>Text Case Converter</a>
                <a href='../Utilities/Income-Expenses-Tracker.html'>Income & Expenses Tracker</a>
                <a href='calculator.html'>Calculator</a> <a href='../Utilities/qr-code-generator.html'>QR Code Generator & Extrater</a>
                <a href='../Utilities.html#function5'>Barcode Generator</a>
                <a href='../Utilities/currency-converter.html'>Currency Converter</a>
                <a href='notepad.html'>Online Notepad</a>
                <a href='../Utilities.html#function8'>Screen Recoder</a>
                <a href='../Utilities.html#function9'>Unit Converter</a>
            </div>
        </div>
    </nav></div><nav class='main-nav'>
    <div class='theme-selector'>
        <label for='theme-picker'>Theme:</label>
        <select id='theme-picker'>
            <option value='corporate-blue' selected='selected'>Corporate Blue</option>
            <option value='forest-green'>Forest Green</option>
            <option value='sunset-gradient'>Sunset Gradient</option>
            <option value='tech-noir'>Tech Noir</option>
            <option value='minty-fresh'>Minty Fresh</option>
            <option value='royal-purple'>Royal Purple</option>
            <option value='graphite-gray'>Graphite Gray</option>
            <option value='crimson-red'>Crimson Red</option>
        </select>
    </div>
    <button id='dark-mode-toggle' class='nav-button' aria-label='Toggle Dark Mode'>
        <i class='fa-solid fa-moon'></i><i class='fa-solid fa-sun'></i>
    </button>
</nav>
  
</header>
<main class='dashboard-container'>
    <div class='dashboard-header'>
        <h2>Professional Calculator</h2>
        <p>Your workspace for calculations, with persistent history.</p>
    </div>

    <div class="app-wrapper">
        <div class="calculator-container glass-container" id="calculator-app">
            <div class="calculator-toggle">
                <span>Normal</span>
                <label class="switch">
                    <input type="checkbox" id="calc-mode-toggle">
                    <span class="slider"></span>
                </label>
                <span>Advance</span>
            </div>
            <div class="calculator-display" id="calc-display">0</div>
            
            <div class="calculator-keypads">
                <div class="calculator-keys-sci">
                    <button class="key-sci" data-key-type="sci" data-action="pow-2">x²</button>
                    <button class="key-sci" data-key-type="sci" data-action="pow-y">xʸ</button>
                    <button class="key-sci" data-key-type="sci" data-action="sin">sin</button>
                    <button class="key-sci" data-key-type="sci" data-action="cos">cos</button>
                    <button class="key-sci" data-key-type="sci" data-action="tan">tan</button>
                    
                    <button class="key-sci" data-key-type="sci" data-action="sqrt">√</button>
                    <button class="key-sci" data-key-type="sci" data-action="inv">1/x</button>
                    <button class="key-sci" data-key-type="sci" data-action="log">log</button>
                    <button class="key-sci" data-key-type="sci" data-action="ln">ln</button>
                    <button class="key-sci" data-key-type="sci" data-action="e">e</button>
                    
                    <button class="key-sci" data-key-type="sci" data-action="pi">π</button>
                    <button class="key-sci" data-key-type="sci" data-action="open-paren">(</button>
                    <button class="key-sci" data-key-type="sci" data-action="close-paren">)</button>
                    <button class="key-sci" data-key-type="sci" data-action="percent">%</button>
                    <button class="key-sci" data-key-type="sci" data-action="negate">+/-</button>
                </div>
                
                <div class="calculator-keys-standard">
                    <button class="key-clear" data-key-type="clear" data-action="clear">AC</button>
                    <button class="key-backspace" data-key-type="backspace" data-action="backspace">DEL</button>
                    <button class="key-operator" data-key-type="operator" data-action="divide">÷</button>
                    <button class="key-operator" data-key-type="operator" data-action="multiply">×</button>
                    
                    <button data-key-type="number">7</button>
                    <button data-key-type="number">8</button>
                    <button data-key-type="number">9</button>
                    <button class="key-operator" data-key-type="operator" data-action="subtract">−</button>
                    
                    <button data-key-type="number">4</button>
                    <button data-key-type="number">5</button>
                    <button data-key-type="number">6</button>
                    <button class="key-operator" data-key-type="operator" data-action="add">+</button>
                    
                    <button data-key-type="number">1</button>
                    <button data-key-type="number">2</button>
                    <button data-key-type="number">3</button>
                    <button class="key-equals" data-key-type="equals" data-action="calculate">=</button>
                    
                    <button data-key-type="number" class="key-span-2">0</button>
                    <button data-key-type="decimal" data-action="decimal">.</button>
                </div>
            </div>
        </div>

        <div class="history-container glass-container">
             <div class="history-header">
                <h3>History</h3>
                <button id="clear-history-btn">Clear</button>
            </div>
            <ul id="history-list">
                </ul>
        </div>
    </div>

</main>
<script>
document.addEventListener('DOMContentLoaded', () => {
    
    // --- Theme and Dark Mode Event Listeners ---
    const themePicker = document.getElementById('theme-picker');
    const darkModeToggle = document.getElementById('dark-mode-toggle');
    const htmlElement = document.documentElement;

    const setTheme = (theme) => {
        htmlElement.dataset.theme = theme;
        localStorage.setItem('jkm-edit-theme', theme);
    };
    const enableDarkMode = () => {
        htmlElement.classList.add('dark-mode');
        localStorage.setItem('jkm-edit-mode', 'dark');
    };
    const disableDarkMode = () => {
        htmlElement.classList.remove('dark-mode');
        localStorage.setItem('jkm-edit-mode', 'light');
    };
    themePicker.addEventListener('change', () => setTheme(themePicker.value));
    darkModeToggle.addEventListener('click', () => {
        htmlElement.classList.contains('dark-mode') ? disableDarkMode() : enableDarkMode();
    });
    const savedTheme = localStorage.getItem('jkm-edit-theme');
    if (savedTheme) {
        themePicker.value = savedTheme;
    }

    // ==============================================
    // === CALCULATOR SCRIPT ===
    // ==============================================
    const calculator = document.getElementById('calculator-app');
    if (calculator) {
        const display = document.getElementById('calc-display');
        const modeToggle = document.getElementById('calc-mode-toggle');
        const historyList = document.getElementById('history-list');
        const clearHistoryBtn = document.getElementById('clear-history-btn');
        const HISTORY_STORAGE_KEY = 'jkm-calc-history';
        
        let displayValue = '0';
        let firstOperand = null;
        let waitingForSecondOperand = false;
        let operator = null;
        let expression = ''; // For history

        function updateDisplay() {
            display.textContent = displayValue;
        }
        updateDisplay();
        
        // --- History Functions ---
        function loadHistory() {
            historyList.innerHTML = localStorage.getItem(HISTORY_STORAGE_KEY) || '';
        }
        
        function saveHistory() {
            localStorage.setItem(HISTORY_STORAGE_KEY, historyList.innerHTML);
        }
        
        function clearHistory() {
            historyList.innerHTML = '';
            saveHistory();
        }
        
        function addToHistory(expr, result) {
            const li = document.createElement('li');
            li.innerHTML = `
                <span class="history-expression">${expr} =</span>
                <span class="history-result">${result}</span>
            `;
            historyList.prepend(li); // Add to top
            saveHistory();
        }
        
        clearHistoryBtn.addEventListener('click', clearHistory);
        loadHistory(); // Load on page start

        // --- Calculator Functions ---
        function inputDigit(digit) {
            if (waitingForSecondOperand) {
                displayValue = digit;
                waitingForSecondOperand = false;
            } else {
                displayValue = displayValue === '0' ? digit : displayValue + digit;
            }
            // If we're not waiting for a second operand, we're building the first number
            if (!operator) {
                expression = displayValue;
            } else {
                // We are building the second number
                expression += digit;
            }
        }

        function inputDecimal() {
            if (waitingForSecondOperand) {
                displayValue = '0.';
                waitingForSecondOperand = false;
                expression += '0.';
                return;
            }
            if (!displayValue.includes('.')) {
                displayValue += '.';
                expression += '.';
            }
        }

        function handleOperator(nextOperator) {
            const inputValue = parseFloat(displayValue);
            
            // Handle percent - this is an immediate operation
            if (nextOperator === 'percent') {
                const result = inputValue / 100;
                addToHistory(`${displayValue}%`, result);
                displayValue = `${result}`;
                expression = `${result}`;
                return;
            }
            
            // Handle +/- - this is an immediate operation
            if (nextOperator === 'negate') {
                const result = inputValue * -1;
                displayValue = `${result}`;
                expression = `${result}`;
                return;
            }

            // If user chains operators (e.g., 5 + * 2)
            if (operator && waitingForSecondOperand) {
                operator = nextOperator;
                // Fix expression string
                expression = `${firstOperand} ${getOperatorSymbol(operator)} `;
                return;
            }

            // If this is the first number
            if (firstOperand === null) {
                firstOperand = inputValue;
            } else if (operator) {
                // This means we have a firstOperand, an operator, and a new inputValue. Time to calculate.
                const result = calculate(firstOperand, operator, inputValue);
                
                // --- THIS IS THE FIX ---
                // 'expression' already holds the full string (e.g., "2 + 2")
                // We log it *before* it gets reset.
                const fullExpression = expression;
                addToHistory(fullExpression, result);

                displayValue = `${parseFloat(result.toFixed(10))}`;
                firstOperand = result;
            }
            
            // Handle equals
            if (nextOperator === 'calculate') {
                firstOperand = null;
                operator = null;
                expression = displayValue; // Set expression to the result
            } else {
                // This is for a standard operator (+, -, etc.)
                operator = nextOperator;
                // Set expression for the *next* operation
                expression = `${firstOperand} ${getOperatorSymbol(nextOperator)} `;
            }
            
            waitingForSecondOperand = true;
        }
        
        function getOperatorSymbol(op) {
            switch (op) {
                case 'add': return '+';
                case 'subtract': return '−';
                case 'multiply': return '×';
                case 'divide': return '÷';
                case 'pow-y': return '^';
                default: return '';
            }
        }

        function calculate(first, op, second) {
            switch (op) {
                case 'add': return first + second;
                case 'subtract': return first - second;
                case 'multiply': return first * second;
                case 'divide': return first / second;
                case 'pow-y': return Math.pow(first, second);
                default: return second;
            }
        }

        function resetCalculator() {
            displayValue = '0';
            firstOperand = null;
            waitingForSecondOperand = false;
            operator = null;
            expression = '';
        }
        
        function backspace() {
            displayValue = displayValue.length > 1 ? displayValue.slice(0, -1) : '0';
            // Simple sync for expression.
            expression = displayValue;
        }

        function handleSciAction(action) {
            let inputValue = parseFloat(displayValue);
            let result = inputValue;
            let exprPrefix = action;
            let exprSuffix = `(${displayValue})`;

            switch (action) {
                case 'sin': result = Math.sin(inputValue * Math.PI / 180); break;
                case 'cos': result = Math.cos(inputValue * Math.PI / 180); break;
                case 'tan': result = Math.tan(inputValue * Math.PI / 180); break;
                case 'ln': result = Math.log(inputValue); break;
                case 'log': result = Math.log10(inputValue); break;
                case 'sqrt': exprPrefix = '√'; result = Math.sqrt(inputValue); break;
                case 'pow-2': exprPrefix = ''; exprSuffix = `(${displayValue})²`; result = Math.pow(inputValue, 2); break;
                case 'inv': exprPrefix = '1/'; result = 1 / inputValue; break;
                case 'pi': exprPrefix = ''; exprSuffix = ''; result = Math.PI; break;
                case 'e': exprPrefix = ''; exprSuffix = ''; result = Math.E; break;
                case 'open-paren': expression += '('; return;
                case 'close-paren': expression += ')'; return;
                case 'percent': handleOperator('percent'); return; 
                case 'negate': handleOperator('negate'); return;
            }
            
            result = parseFloat(result.toFixed(10));
            addToHistory(`${exprPrefix}${exprSuffix}`, result);
            displayValue = `${result}`;
            expression = `${result}`;
            waitingForSecondOperand = true;
        }

        // Click listener for all buttons
        calculator.addEventListener('click', e => {
            const key = e.target.closest('button');
            if (!key) return;

            const { keyType, action } = key.dataset;

            if (keyType === 'number') inputDigit(key.textContent);
            if (keyType === 'decimal') inputDecimal();
            if (keyType === 'operator' || keyType === 'equals') handleOperator(action);
            if (keyType === 'clear') resetCalculator();
            if (keyType === 'backspace') backspace();
            if (keyType === 'sci') {
                if(action === 'pow-y') {
                    handleOperator(action);
                } else {
                    handleSciAction(action);
                }
            }
            updateDisplay();
        });

        // Toggle Scientific Mode
        modeToggle.addEventListener('change', () => {
            calculator.classList.toggle('scientific-mode');
        });
        
        // --- Keyboard Support ---
        window.addEventListener('keydown', (e) => {
            const activeEl = document.activeElement;
            if (activeEl.tagName === 'INPUT' || activeEl.tagName === 'TEXTAREA' || activeEl.isContentEditable) {
                return;
            }
            
            e.preventDefault(); 
            
            let key = e.key;
            let button;
            
            if (key >= '0' && key <= '9') {
                inputDigit(key);
            } else if (key === '.') {
                inputDecimal();
            } else if (key === '+') {
                handleOperator('add');
            } else if (key === '-') {
                handleOperator('subtract');
            } else if (key === '*') {
                handleOperator('multiply');
            } else if (key === '/') {
                handleOperator('divide');
            } else if (key === 'Enter' || key === '=') {
                handleOperator('calculate');
            } else if (key === 'Backspace') {
                backspace();
            } else if (key === 'Escape') {
                resetCalculator();
            } else if (key === '%') {
                handleSciAction('percent');
            } else if (key === '(') {
                handleSciAction('open-paren');
            } else if (key === ')') {
                handleSciAction('close-paren');
            } else {
                return;
            }
            
            updateDisplay();
            
            // Visual feedback for key press
            if (key === 'Enter' || key === '=') button = document.querySelector(`button[data-action="calculate"]`);
            else if (key === '+') button = document.querySelector(`button[data-action="add"]`);
            else if (key === '-') button = document.querySelector(`button[data-action="subtract"]`);
            else if (key === '*') button = document.querySelector(`button[data-action="multiply"]`);
            else if (key === '/') button = document.querySelector(`button[data-action="divide"]`);
            else if (key === 'Backspace') button = document.querySelector(`button[data-action="backspace"]`);
            else if (key === 'Escape') button = document.querySelector(`button[data-action="clear"]`);
            else if (key === '%') button = document.querySelector(`button[data-action="percent"]`);
            else if (key === '(') button = document.querySelector(`button[data-action="open-paren"]`);
            else if (key === ')') button = document.querySelector(`button[data-action="close-paren"]`);
            else button = Array.from(calculator.querySelectorAll('button[data-key-type="number"]')).find(btn => btn.textContent === key);
            
            if (button) {
                button.classList.add('key-active');
                setTimeout(() => button.classList.remove('key-active'), 100);
            }
        });
    }
});
</script>
</body>
</html>
