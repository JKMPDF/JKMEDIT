<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>24Ã—7 Admin Radio</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    margin: 0;
    height: 100vh;
    background: #0d0d0d;
    color: white;
    font-family: Arial, sans-serif;
    display: flex;
    align-items: center;
    justify-content: center;
}
.box {
    background: #1c1c1c;
    padding: 25px;
    width: 320px;
    border-radius: 14px;
    text-align: center;
}
button {
    background: #ff0055;
    color: white;
    border: none;
    padding: 12px 25px;
    border-radius: 25px;
    cursor: pointer;
}
.admin {
    position: fixed;
    bottom: 20px;
    right: 20px;
    cursor: pointer;
}
.panel {
    position: fixed;
    top: 0;
    right: -300px;
    width: 260px;
    height: 100vh;
    background: #111;
    padding: 20px;
    transition: 0.3s;
}
.panel.open { right: 0; }
input, select {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    background: #222;
    border: 1px solid #444;
    color: white;
}
</style>
</head>

<body>

<div class="box">
    <h2>JKM 24Ã—7 Radio</h2>
    <p id="now">Click to start</p>
    <button onclick="startRadio()">â–¶ JOIN RADIO</button>
    <audio id="audio"></audio>
</div>

<div class="admin" onclick="toggleAdmin()">ðŸ”’</div>

<div class="panel" id="panel">
    <h3>Admin</h3>
    <input type="password" id="pass" placeholder="Password">
    <button onclick="login()">Login</button>

    <div id="controls" style="display:none">
        <hr>
        <select onchange="setGenre(this.value)">
            <option value="bollywood">Bollywood</option>
            <option value="english">English</option>
            <option value="lofi">Lofi</option>
        </select>

        <input id="songUrl" placeholder="MP3 URL">
        <button onclick="forceSong()">Play Song</button>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

/* ðŸ”¥ FIREBASE (FIXED) */
const firebaseConfig = {
  apiKey: "AIzaSyDkhqOMIFrgs_obaub-YblXuBLnbaGlZXQ",
  authDomain: "jkm-music.firebaseapp.com",
  databaseURL: "https://jkm-music-default-rtdb.firebaseio.com",
  projectId: "jkm-music",
  storageBucket: "jkm-music.appspot.com",
  messagingSenderId: "622011433252",
  appId: "1:622011433252:web:6df9638a3d544b7c5fb3b1"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const audio = document.getElementById("audio");
const now = document.getElementById("now");

let userStarted = false;

/* ðŸŽ§ USER START */
window.startRadio = () => {
    userStarted = true;
    audio.play().catch(()=>{});
};

/* ðŸ” SYNC FROM ADMIN */
onValue(ref(db, "radio"), snap => {
    if (!snap.exists() || !userStarted) return;

    const data = snap.val();
    audio.src = data.url;
    audio.load();
    audio.play();
    now.innerText = data.title;
});

/* ðŸ” ADMIN */
window.toggleAdmin = () => {
    document.getElementById("panel").classList.toggle("open");
};

window.login = () => {
    if (document.getElementById("pass").value === "admin123") {
        document.getElementById("controls").style.display = "block";
        alert("Admin logged in");
    }
};

const playlist = {
    bollywood: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3",
    english: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3",
    lofi: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3"
};

window.setGenre = g => {
    set(ref(db, "radio"), {
        url: playlist[g],
        title: g.toUpperCase() + " RADIO"
    });
};

window.forceSong = () => {
    const url = document.getElementById("songUrl").value;
    if (!url) return alert("Enter MP3 URL");
    set(ref(db, "radio"), {
        url,
        title: "Admin Selected Song"
    });
};
</script>

</body>
</html>
